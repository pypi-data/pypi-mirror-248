<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hyper-usable HTTP client &mdash; P2PD 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lightweight web framework" href="http_framework.html" />
    <link rel="prev" title="More portable netifaces" href="netifaces.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            P2PD
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../problems.html">The problem with P2P networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how.html">How P2PD works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Using P2PD from Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest_api.html">The P2PD REST API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Awesome stuff built with P2PD</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="stun.html">STUN client for address lookups</a></li>
<li class="toctree-l2"><a class="reference internal" href="turn.html">TURN client for proxying</a></li>
<li class="toctree-l2"><a class="reference internal" href="netifaces.html">More portable netifaces</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Hyper-usable HTTP client</a></li>
<li class="toctree-l2"><a class="reference internal" href="http_framework.html">Lightweight web framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="toxiproxy.html">Toxiproxy client and server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../future_work.html">Future work</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">P2PD</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Awesome stuff built with P2PD</a></li>
      <li class="breadcrumb-item active">Hyper-usable HTTP client</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/built/http_client.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="hyper-usable-http-client">
<h1>Hyper-usable HTTP client<a class="headerlink" href="#hyper-usable-http-client" title="Permalink to this heading"></a></h1>
<p>When I built my own REST framework it’s been necessary to also build
a basic HTTP client. The reason I’ve done this is I wanted the client
to be compatible with the existing capabilities this software offers
like being able to easily leverage multiple network interfaces and
utilize the external addresses they have access to.</p>
<p>In my opinion one design that absolutely nailed building services
for the web was PHP so my HTTP client takes inspiration from that.
First lets start with a basic GET request.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">p2pd</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="n">i</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Interface</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Address</span><span class="p">(</span><span class="s2">&quot;www.example.com&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">route</span><span class="p">())</span>
    <span class="n">curl</span> <span class="o">=</span> <span class="n">WebCurl</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">url_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="s2">&quot;lets search!&quot;</span><span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">curl</span><span class="o">.</span><span class="n">vars</span><span class="p">(</span><span class="n">url_params</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">out</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">async_test</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code shows how you can send $_GET params to a website.
Loosely speaking: the vars method is where $_GET and $_POST go.
There is a method for get, post, and delete that cause such
HTTP methods to occur. Here’s an example for POST:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">p2pd</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="n">i</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Interface</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Address</span><span class="p">(</span><span class="s2">&quot;www.example.com&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">route</span><span class="p">())</span>
    <span class="n">curl</span> <span class="o">=</span> <span class="n">WebCurl</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;upload&quot;</span><span class="p">}</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;Data to POST!&quot;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">curl</span><span class="o">.</span><span class="n">vars</span><span class="p">(</span>
        <span class="n">url_params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
        <span class="n">body</span><span class="o">=</span><span class="n">payload</span>
    <span class="p">)</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/meow/cat.php&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">out</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">async_test</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
</pre></div>
</div>
<p>The design of this HTTP client results in copies of the objects
properties being made for each call. This helps to encapsulate
information and makes debugging a breeze. The return value of an API
call is literally a new copy of the client but with additional
properties like pipe, out, and info - try exploring these fields!</p>
<p>The HTTP client also supports custom HTTP headers. You can control
underlying socket parameters with more detail by passing in a custom
NET_CONFIG dictionary to the get, post, and delete methods. This
structure is detailed at the bottom here: <a class="reference internal" href="../python/pipes.html"><span class="doc">here.</span></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WebCurl</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">throttle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">do_close</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hdrs</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        throttle = a second timeout to delay a request by.</span>
<span class="sd">        do_close = whether or not the underlying pipe is closed (</span>
<span class="sd">            useful if you&#39;re streaming data and such.)</span>
<span class="sd">        hdrs = Custom HTTP request headers e.g.:</span>
<span class="sd">            [[b&quot;user-agent&quot;, b&quot;toxiproxy-cli&quot;]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">hdrs</span><span class="o">=</span><span class="p">[],</span> <span class="n">conf</span><span class="o">=</span><span class="n">NET_CONF</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="c1">#</span>
    <span class="c1">#...</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="netifaces.html" class="btn btn-neutral float-left" title="More portable netifaces" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="http_framework.html" class="btn btn-neutral float-right" title="Lightweight web framework" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>