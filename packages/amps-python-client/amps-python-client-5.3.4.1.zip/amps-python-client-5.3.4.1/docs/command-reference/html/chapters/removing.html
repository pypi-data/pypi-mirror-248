<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5. Removing or Acknowledging Messages &#8212; Advanced Message Processing System (AMPS) Command Reference develop
 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'develop',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Utility Commands" href="utilities.html" />
    <link rel="prev" title="4. Querying and Subscribing" href="query-subscribe.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/flag_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5. Removing or Acknowledging Messages</a><ul>
<li><a class="reference internal" href="#sow-delete">sow_delete</a><ul>
<li><a class="reference internal" href="#header-fields">Header Fields</a></li>
<li><a class="reference internal" href="#returns">Returns</a><ul>
<li><a class="reference internal" href="#topicmatches">TopicMatches</a></li>
<li><a class="reference internal" href="#matches">Matches</a></li>
<li><a class="reference internal" href="#recordsdeleted">RecordsDeleted</a></li>
</ul>
</li>
<li><a class="reference internal" href="#errors">Errors</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="query-subscribe.html" title="previous chapter">4. Querying and Subscribing</a></li>
      <li>Next: <a href="utilities.html" title="next chapter">6. Utility Commands</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="removing-or-acknowledging-messages">
<span id="command-guide-removing-messages"></span><h1>5. Removing or Acknowledging Messages<a class="headerlink" href="#removing-or-acknowledging-messages" title="Permalink to this headline">¶</a></h1>
<div class="section" id="sow-delete">
<h2>sow_delete<a class="headerlink" href="#sow-delete" title="Permalink to this headline">¶</a></h2>
<p>In AMPS, there are three different ways to remove records from the SOW.
The first method is to construct a <code class="docutils literal"><span class="pre">publish</span></code> message that matches the
message to be removed, with the <code class="docutils literal"><span class="pre">Command</span></code> field set to be a
<code class="docutils literal"><span class="pre">sow_delete</span></code> message. This has the net effect of causing AMPS recreate
the <code class="docutils literal"><span class="pre">SowKey</span></code> for the particular message, then look up the <code class="docutils literal"><span class="pre">SowKey</span></code>
message in the SOW and finally remove it.</p>
<p>The other method to remove messages from the SOW is to construct a
<code class="docutils literal"><span class="pre">sow_delete</span></code> message and pass in a comma separated list of
<code class="docutils literal"><span class="pre">SowKey</span></code>s in the message header which will cause all of the messages
to be removed from the SOW Topic.</p>
<p>The third way to remove records from the SOW is similar to the manner in
which a <code class="docutils literal"><span class="pre">sow</span></code> query command with a <code class="docutils literal"><span class="pre">filter</span></code> is performed. In this
case, instead of returning the results of the <code class="docutils literal"><span class="pre">sow</span></code> command, those
records that match the filter will be deleted from the SOW.</p>
<p>The <code class="docutils literal"><span class="pre">sow_delete</span></code> command is also used to acknowledge messages from
a queue. With this form of <code class="docutils literal"><span class="pre">sow_delete</span></code>, a client sends one or more
bookmarks (as a comma-delimited list) that specify the messages to acknowledge.
This form can only be used for acknowledging messages from a queue topic.</p>
<div class="section" id="header-fields">
<h3>Header Fields<a class="headerlink" href="#header-fields" title="Permalink to this headline">¶</a></h3>
<p>The following table
contains the header fields supported by a <code class="docutils literal"><span class="pre">sow_delete</span></code>.</p>
<table border="1" class="docutils" id="command-sow-delete-headers">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Field</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Command</span></code></td>
<td>Command to be executed. Value: <code class="docutils literal"><span class="pre">sow_delete</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Topic</span></code></td>
<td>The SOW Topic from which to delete the
messages(s).</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AckType</span></code></td>
<td>Acknowledgment type for the given command. Value
is a comma separated list of one or more of the
following: <code class="docutils literal"><span class="pre">none</span></code>, <code class="docutils literal"><span class="pre">received</span></code>,
<code class="docutils literal"><span class="pre">processed</span></code>, <code class="docutils literal"><span class="pre">persisted</span></code>, <code class="docutils literal"><span class="pre">completed</span></code> and
<code class="docutils literal"><span class="pre">stats</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CommandId</span></code></td>
<td>If specified with an AMPS command requesting an
<code class="docutils literal"><span class="pre">ack</span></code>, all requested acknowledgment messages
will contain the <code class="docutils literal"><span class="pre">CommandId</span></code> in the
acknowledgment message header.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SowKeys</span></code></td>
<td>A comma separated list of unique ids to be
deleted. AMPS uses these ids to locate and
remove the specified records. Notice that these
values are the internal ID used by AMPS &#8211; the
SowKey &#8211; and not the value of a field in the
message. To use the values of fields in the
message to locate the records to remove, use a
<code class="docutils literal"><span class="pre">Filter</span></code> or <code class="docutils literal"><span class="pre">Data</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Filter</span></code></td>
<td>Content filter expression. See the <em>Content
Filtering</em> chapter in the <em>AMPS User Guide</em> for
more information on using content filters. When
provided, AMPS removes the matching records.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Data</span></code></td>
<td>Message data that identifies the record to be
removed. When provided, AMPS uses this <code class="docutils literal"><span class="pre">Data</span></code>
to look up the record that would be updated were
this command a publish. AMPS then deletes that
record.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Bookmark</span></code></td>
<td>Processed when the <code class="docutils literal"><span class="pre">sow_delete</span></code> command is
acknowledging a message from a queue. When this
option is used, the message must have been
provided from a message queue, and the
<code class="docutils literal"><span class="pre">SowKeys</span></code> and <code class="docutils literal"><span class="pre">Filter</span></code> headers may not be
used.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Options</span></code></td>
<td>Available when the <code class="docutils literal"><span class="pre">sow_delete</span></code> command is
acknowledging a message from a queue. When a
value of <code class="docutils literal"><span class="pre">cancel</span></code> is provided in this field,
the message is returned to the queue and made
available to other subscribers. When a value of
<code class="docutils literal"><span class="pre">expire</span></code> is provided in this field, the message
is automatically expired by AMPS, removing the
message from the queue and invoking any actions
configured to listen for message expirations.</td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>The <code class="docutils literal"><span class="pre">SowKeys</span></code>, <code class="docutils literal"><span class="pre">Filter</span></code>, <code class="docutils literal"><span class="pre">Data</span></code> and <code class="docutils literal"><span class="pre">Bookmark</span></code> header
fields cannot be used together. They are mutually exclusive.
Using them together in the same <code class="docutils literal"><span class="pre">sow_delete</span></code> command will
cause indeterminate results.</p>
<p class="last">The <code class="docutils literal"><span class="pre">Bookmark</span></code> header can only be used to acknowledge messages
from queue topics.</p>
</div>
</div>
<div class="section" id="returns">
<h3>Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h3>
<p>For a <code class="docutils literal"><span class="pre">sow_delete</span></code> message, AMPS will send acknowledgment message,
<code class="docutils literal"><span class="pre">completed</span></code> and <code class="docutils literal"><span class="pre">stats</span></code> for the following acknowledgment message
types: <code class="docutils literal"><span class="pre">received</span></code>, <code class="docutils literal"><span class="pre">processed</span></code> and <code class="docutils literal"><span class="pre">persisted</span></code> along with a
populated <code class="docutils literal"><span class="pre">Status</span></code> header field describing the acknowledgment.</p>
<table border="1" class="docutils" id="command-sow-delete-acks">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Acknowledgment</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">none</span></code></td>
<td>No acknowledgment message is returned. This is
the default behavior.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">completed</span></code></td>
<td>Supported for a <code class="docutils literal"><span class="pre">sow_delete</span></code> with a <code class="docutils literal"><span class="pre">Filter</span></code>
defined. The <code class="docutils literal"><span class="pre">completed</span></code> acknowledgment
message is returned when the query portion of
the command has completed.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">persisted</span></code></td>
<td><p class="first">When an AMPS engine returns an acknowledgment
message of <code class="docutils literal"><span class="pre">persisted</span></code> this guarantees that</p>
<p>1. All downstream synchronous replication(s)
have acknowledged that the message(s) have
been deleted from their respective SOW
topic(s).</p>
<p class="last">2. The <code class="docutils literal"><span class="pre">sow_delete</span></code> message has been sent to
all available downstream asynchronous
replications.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">processed</span></code></td>
<td>AMPS has compiled the filter(s) for the
<code class="docutils literal"><span class="pre">sow_delete</span></code> messages.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">received</span></code></td>
<td>The <code class="docutils literal"><span class="pre">sow_delete</span></code> message has been received.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">stats</span></code></td>
<td>Returns an acknowledgment message with
<code class="docutils literal"><span class="pre">Matches</span></code>, <code class="docutils literal"><span class="pre">TopicMatches</span></code> and
<code class="docutils literal"><span class="pre">RecordsDeleted</span></code>.</td>
</tr>
</tbody>
</table>
<p><em>Acknowledgment messages types supported by sow_delete</em></p>
<p>The <code class="docutils literal"><span class="pre">stats</span></code> acknowledgment message include three values in the header,
the <code class="docutils literal"><span class="pre">Matches</span></code>, <code class="docutils literal"><span class="pre">TopicMatches</span></code> and the <code class="docutils literal"><span class="pre">RecordsDeleted</span></code>. These are
defined below:</p>
<div class="section" id="topicmatches">
<h4>TopicMatches<a class="headerlink" href="#topicmatches" title="Permalink to this headline">¶</a></h4>
<p>The total number of records compared across all matching SOW topics.</p>
</div>
<div class="section" id="matches">
<h4>Matches<a class="headerlink" href="#matches" title="Permalink to this headline">¶</a></h4>
<p>The number of records returned that match the topic regular expression
and the content filter.</p>
</div>
<div class="section" id="recordsdeleted">
<h4>RecordsDeleted<a class="headerlink" href="#recordsdeleted" title="Permalink to this headline">¶</a></h4>
<p>The total number of records deleted.</p>
</div>
</div>
<div class="section" id="errors">
<h3>Errors<a class="headerlink" href="#errors" title="Permalink to this headline">¶</a></h3>
<p>Errors that occur during a <code class="docutils literal"><span class="pre">sow_delete</span></code> are returned as part of the
<code class="docutils literal"><span class="pre">processed</span></code> acknowledgment message and recorded to the log. Typical
errors involved a missing topic, or a missing/invalid <code class="docutils literal"><span class="pre">SowKey</span></code>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, 60East Technologies, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>