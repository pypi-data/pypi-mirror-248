"use strict";(globalThis["webpackChunkphotobooth_app_frontend"]=globalThis["webpackChunkphotobooth_app_frontend"]||[]).push([[547],{16584:(e,t,i)=>{i.d(t,{Z:()=>P});var o=i(59835),l=i(86970);const r={key:4,class:"q-mr-sm"},n={class:"q-mr-sm"},a={class:"absolute-bottom-left text-subtitle2"},s={key:0,class:"full-height"},d=["src"],c={key:1,class:"full-height"},m=["src"],g={class:"q-gutter-sm"};function u(e,t,i,u,p,h){const w=(0,o.up)("q-btn"),y=(0,o.up)("q-space"),S=(0,o.up)("q-icon"),f=(0,o.up)("q-toolbar"),I=(0,o.up)("q-linear-progress"),v=(0,o.up)("q-header"),_=(0,o.up)("q-img"),q=(0,o.up)("q-drawer"),k=(0,o.up)("q-card"),b=(0,o.up)("q-carousel-slide"),x=(0,o.up)("q-carousel"),D=(0,o.up)("vue-qrcode"),R=(0,o.up)("q-page-sticky"),Z=(0,o.up)("q-page-container"),T=(0,o.up)("q-layout"),Q=(0,o.Q2)("touch-swipe");return h.emptyRepository?((0,o.wg)(),(0,o.j4)(T,{key:1,view:"hhh Lpr ffr"},{default:(0,o.w5)((()=>[(0,o.Uk)("EMPTY")])),_:1})):((0,o.wg)(),(0,o.j4)(T,{key:0,view:"hhh Lpr ffr",onClick:h.abortTimer},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{elevated:"",class:"bg-primary text-white"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{class:"toolbar"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{dense:"",flat:"",icon:"close",size:"1.5rem",onClick:t[0]||(t[0]=t=>e.$emit("closeEvent"))}),(0,o.Wm)(y),u.uiSettingsStore.uiSettings.gallery_show_delete?((0,o.wg)(),(0,o.j4)(w,{key:0,flat:"",class:"q-mr-sm",icon:"delete",label:"Delete",onClick:t[1]||(t[1]=t=>{h.deleteItem(u.currentSlideId),e.$emit("closeEvent")})})):(0,o.kq)("",!0),u.uiSettingsStore.uiSettings.gallery_show_download?((0,o.wg)(),(0,o.j4)(w,{key:1,flat:"",class:"q-mr-sm",icon:"download",label:"Download",onClick:t[2]||(t[2]=e=>{u.openURL(i.itemRepository[u.currentSlideIndex]["full"])})})):(0,o.kq)("",!0),u.uiSettingsStore.uiSettings.gallery_show_print?((0,o.wg)(),(0,o.j4)(w,{key:2,flat:"",class:"q-mr-sm",icon:"print",label:"Print",onClick:t[3]||(t[3]=e=>h.printItem(u.currentSlideId))})):(0,o.kq)("",!0),u.uiSettingsStore.uiSettings.gallery_show_filter&&u.uiSettingsStore.uiSettings.gallery_filter_userselectable.length>0?((0,o.wg)(),(0,o.j4)(w,{key:3,flat:"",class:"q-mr-sm",icon:"filter",label:"Filter",onClick:u.toggleRightDrawer},null,8,["onClick"])):(0,o.kq)("",!0),(0,o.Wm)(y),i.singleItemView?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",r,[(0,o.Wm)(S,{name:"tag"}),(0,o._)("span",null,(0,l.zw)(u.currentSlideIndex+1)+" of "+(0,l.zw)(i.itemRepository.length)+" total",1)])),(0,o.Wm)(y),(0,o._)("div",n,[(0,o.Wm)(S,{name:"image"}),(0,o.Uk)(" "+(0,l.zw)(i.itemRepository[u.currentSlideIndex]["caption"]),1)])])),_:1}),p.displayLinearProgressBar&&p.remainingSeconds>0?((0,o.wg)(),(0,o.j4)(I,{key:0,class:"absolute",value:p.remainingSecondsNormalized,"animation-speed":"200",color:"grey"},null,8,["value"])):(0,o.kq)("",!0),u.displayLoadingSpinner?((0,o.wg)(),(0,o.j4)(I,{key:1,class:"absolute",indeterminate:"","animation-speed":"2100",color:"primary"})):(0,o.kq)("",!0)])),_:1}),u.uiSettingsStore.uiSettings.gallery_show_filter?((0,o.wg)(),(0,o.j4)(q,{key:0,modelValue:u.rightDrawerOpen,"onUpdate:modelValue":t[4]||(t[4]=e=>u.rightDrawerOpen=e),side:"right",elevated:"",overlay:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(u.uiSettingsStore.uiSettings.gallery_filter_userselectable,(e=>((0,o.wg)(),(0,o.j4)(_,{src:`/mediaprocessing/preview/${u.currentSlideId}/${e}`,key:e,onClick:t=>h.applyFilter(u.currentSlideId,e)},{default:(0,o.w5)((()=>[(0,o._)("div",a,(0,l.zw)(e),1)])),_:2},1032,["src","onClick"])))),128))])),_:1},8,["modelValue"])):(0,o.kq)("",!0),(0,o.Wm)(Z,{class:"q-pa-none galleryimagedetail full-height"},{default:(0,o.w5)((()=>[i.singleItemView?((0,o.wg)(),(0,o.iD)("div",s,[(0,o.Wm)(k,{class:"column no-wrap flex-center full-height q-pa-sm"},{default:(0,o.w5)((()=>[(0,o._)("img",{draggable:!1,class:"rounded-borders full-height",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},src:this.itemRepository[0].preview},null,8,d)])),_:1})])):((0,o.wg)(),(0,o.iD)("div",c,[(0,o.wy)(((0,o.wg)(),(0,o.j4)(x,{class:"",style:{width:"100%",height:"100%"},"control-type":"flat","control-color":"primary",swipeable:"",animated:"",modelValue:u.currentSlideId,"onUpdate:modelValue":t[5]||(t[5]=e=>u.currentSlideId=e),autoplay:u.autoplay,draggable:"false",arrows:"","transition-prev":"slide-right","transition-next":"slide-left",onTransition:t[6]||(t[6]=(e,t)=>{u.currentSlideIndex=i.itemRepository.findIndex((t=>t.id===e)),h.abortTimer()})},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(h.slicedImages,(e=>((0,o.wg)(),(0,o.j4)(b,{key:e.id,name:e.id,class:"column no-wrap flex-center full-height q-pa-sm"},{default:(0,o.w5)((()=>[(0,o._)("img",{draggable:!1,class:"rounded-borders full-height",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},src:e.preview},null,8,m)])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue","autoplay"])),[[Q,u.handleSwipeDown,void 0,{mouse:!0,down:!0}]])])),u.uiSettingsStore.uiSettings.gallery_show_qrcode?((0,o.wg)(),(0,o.j4)(R,{key:2,position:"top-right",offset:[30,30]},{default:(0,o.w5)((()=>[(0,o._)("div",g,[(0,o.Wm)(D,{type:"image/png",tag:"svg",margin:2,width:200,"error-correction-level":"low",color:{dark:"#111111",light:"#EEEEEE"},value:h.getImageQrData()},null,8,["value"])])])),_:1})):(0,o.kq)("",!0)])),_:1})])),_:1},8,["onClick"]))}i(69665);var p=i(20226),h=i(60499),w=i(96694),y=i(33752),S=i(19302);const f={props:{indexSelected:{type:Number,required:!0},itemRepository:{type:Array,required:!0},startTimerOnOpen:{type:Boolean,required:!1,default:!1},singleItemView:{type:Boolean,default:!1}},computed:{emptyRepository(){return!this.itemRepository||0==this.itemRepository.length},slicedImages(){console.log("changed");this.itemRepository.length;var e=Math.max(0,this.currentSlideIndex-2),t=Math.max(0,this.currentSlideIndex+3);return console.log(this.itemRepository.slice(e,t)),this.itemRepository.slice(e,t)}},beforeCreate(){console.log(this.indexSelected),this.currentSlideIndex=this.indexSelected,this.currentSlideId=this.itemRepository[this.indexSelected].id},data(){return{intervalTimerId:null,remainingSeconds:0,remainingSecondsNormalized:0,displayLinearProgressBar:!0}},setup(){const e=(0,w.R)(),t=(0,h.iH)(!1);(0,S.Z)();return{uiSettingsStore:e,openURL:y.Z,fabRight:(0,h.iH)(!1),currentSlideId:(0,h.iH)(""),currentSlideIndex:(0,h.iH)(0),autoplay:(0,h.iH)(!1),showFilterDialog:(0,h.iH)(!1),displayLoadingSpinner:(0,h.iH)(!1),rightDrawerOpen:t,toggleRightDrawer(){t.value=!t.value},handleSwipeDown({evt:e}){console.log("TODO: add method to close dialog programmatically")}}},components:{VueQrcode:p.ZP},mounted(){this.startTimerOnOpen&&this.startTimer()},beforeUnmount(){clearInterval(this.intervalTimerId)},methods:{async reloadImg(e){await fetch(e,{cache:"reload",mode:"no-cors"});const t=(new Date).getTime();document.body.querySelectorAll(`img[src*='${e}']`).forEach((i=>{i.src=e+"#"+t}))},applyFilter(e,t){this.displayLoadingSpinner=!0,this.$api.get(`/mediaprocessing/applyfilter/${e}/${t}`).then((t=>{const i=this.itemRepository.findIndex((t=>t.id===e));this.reloadImg(this.itemRepository[i].full),this.reloadImg(this.itemRepository[i].preview),this.reloadImg(this.itemRepository[i].thumbnail),this.displayLoadingSpinner=!1})).catch((e=>{console.log(e),this.displayLoadingSpinner=!1}))},deleteItem(e){this.$api.get("/mediacollection/delete",{params:{image_id:e}}).then((e=>{console.log(e),this.itemRepository.splice(this.currentSlideIndex,1)})).catch((e=>console.log(e)))},printItem(e){this.$api.get(`/print/item/${e}`).then((e=>{console.log(e),this.$q.notify({message:"Started printing...",type:"positive",spinner:!0})})).catch((e=>{e.response?(console.log(e.response),425==e.response.status?this.$q.notify({message:e.response.data["detail"],caption:"Print Service",type:"info"}):this.$q.notify({message:e.response.data["detail"],caption:"Print Service",type:"negative"})):e.request?console.error(e.request):console.error("Error",e.message)}))},getImageQrData(){return this.itemRepository[this.currentSlideIndex]["share_url"]},abortTimer(){clearInterval(this.intervalTimerId),this.remainingSeconds=0,this.remainingSecondsNormalized=0},startTimer(){var e=this.uiSettingsStore.uiSettings["AUTOCLOSE_NEW_ITEM_ARRIVED"];console.log(`starting newitemarrived timer, duration=${e}`),this.remainingSeconds=e,this.intervalTimerId=setInterval((()=>{this.remainingSecondsNormalized=this.remainingSeconds/e,this.remainingSeconds-=.05,this.remainingSeconds<=0&&(clearInterval(this.intervalTimerId),this.$router.push({path:"/"}))}),50)}}};var I=i(11639),v=i(20249),_=i(16602),q=i(51663),k=i(68879),b=i(90136),x=i(22857),D=i(8289),R=i(10906),Z=i(70335),T=i(12133),Q=i(44458),C=i(97052),j=i(41694),E=i(30627),L=i(64871),$=i(69984),W=i.n($);const H=(0,I.Z)(f,[["render",u],["__scopeId","data-v-a6ace732"]]),P=H;W()(f,"components",{QLayout:v.Z,QHeader:_.Z,QToolbar:q.Z,QBtn:k.Z,QSpace:b.Z,QIcon:x.Z,QLinearProgress:D.Z,QDrawer:R.Z,QImg:Z.Z,QPageContainer:T.Z,QCard:Q.Z,QCarousel:C.Z,QCarouselSlide:j.Z,QPageSticky:E.Z}),W()(f,"directives",{TouchSwipe:L.Z})},80736:(e,t,i)=>{i.r(t),i.d(t,{default:()=>k});var o=i(59835),l=i(86970);const r={key:0,class:"row justify-center q-gutter-sm"},n={class:"absolute-bottom text-subtitle2"},a=["innerHTML"];function s(e,t,i,s,d,c){const m=(0,o.up)("q-img"),g=(0,o.up)("q-card"),u=(0,o.up)("q-intersection"),p=(0,o.up)("gallery-image-detail"),h=(0,o.up)("q-dialog"),w=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(w,{padding:""},{default:(0,o.w5)((()=>[c.isGalleryEmpty?((0,o.wg)(),(0,o.iD)("div",{key:1,innerHTML:s.uiSettingsStore.uiSettings.GALLERY_EMPTY_MSG},null,8,a)):((0,o.wg)(),(0,o.iD)("div",r,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(this.mediacollectionStore.collection,((e,t)=>((0,o.wg)(),(0,o.j4)(u,{key:e.id,once:"",class:"preview-item"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{class:"q-ma-sm",onClick:e=>c.openPic(t)},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{src:c.getImageDetail(t),loading:"eager","no-transition":"","no-spinner":"",ratio:1},{default:(0,o.w5)((()=>[(0,o._)("div",n,(0,l.zw)(this.mediacollectionStore.collection[t].caption),1)])),_:2},1032,["src"])])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),(0,o.Wm)(h,{"transition-show":"jump-up","transition-hide":"jump-down",modelValue:s.showImageDetail,"onUpdate:modelValue":t[1]||(t[1]=e=>s.showImageDetail=e),maximized:""},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{onCloseEvent:t[0]||(t[0]=e=>s.showImageDetail=!1),itemRepository:this.mediacollectionStore.collection,indexSelected:s.indexSelected,class:"full-height"},null,8,["itemRepository","indexSelected"])])),_:1},8,["modelValue"])])),_:1})}var d=i(67575),c=i(96694),m=i(33630),g=i(60499),u=i(16584);const p={components:{GalleryImageDetail:u.Z},setup(){const e=(0,d.h)(),t=(0,c.R)(),i=(0,m.r)();return{store:e,uiSettingsStore:t,mediacollectionStore:i,GalleryImageDetail:u.Z,indexSelected:(0,g.iH)(null),showImageDetail:(0,g.iH)(!1)}},computed:{itemId(){return this.$route.params.id},isGalleryEmpty(){return 0==this.mediacollectionStore.collection_number_of_items}},mounted(){},watch:{itemId(e,t){const i=this.mediacollectionStore.getIndexOfItemId(e);-1==i?console.error(`image id not found ${e}`):this.openPic(i)}},methods:{getImageDetail(e,t="thumbnail"){return this.mediacollectionStore.collection[e][t]},openPic(e){this.indexSelected=e,this.showImageDetail=!0}}};var h=i(11639),w=i(69885),y=i(21517),S=i(44458),f=i(70335),I=i(32074),v=i(69984),_=i.n(v);const q=(0,h.Z)(p,[["render",s],["__scopeId","data-v-8186f0bc"]]),k=q;_()(p,"components",{QPage:w.Z,QIntersection:y.Z,QCard:S.Z,QImg:f.Z,QDialog:I.Z})}}]);