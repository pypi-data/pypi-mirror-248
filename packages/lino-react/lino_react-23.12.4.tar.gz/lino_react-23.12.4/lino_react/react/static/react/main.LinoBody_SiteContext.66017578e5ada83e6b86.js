"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[9779],{1462:(e,t,i)=>{i.r(t),i.d(t,{LinoBody:()=>S,name:()=>R});i(1814);var s=i(1914),o=i(2972),r=i.n(o),n=i(1300),a=i(9281),l=i(6552);let h;h={lc:Promise.all([i.e(1295),i.e(3486),i.e(1473),i.e(7353),i.e(532),i.e(6125),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(8934),i.e(2071),i.e(9158),i.e(6622)]).then(i.bind(i,3900)),u:Promise.resolve().then(i.bind(i,765))};(0,a.RegisterImportPool)(h);class d extends a.Component{constructor(e){super(e),this.navigate=e=>{let t=this.context.navinfo;if(t){let i=this.props.urlParams,s=i.controller,o=`/api/${i.packId}/${i.actorId}`,r=t[e],n=i.detailNav.get(r);n&&s.history.has(n)?s.history.push(s.history.popFromStore(n)):(n=s.newSlug(),i.detailNav.set(r,n),s.history.pushPath({pathname:`${o}/${r}`,params:Object.assign(s.actionHandler.getParams(),{rs:n})}))}},this.navigate=this.navigate.bind(this),this.onKeyDown=this.onKeyDown.bind(this),window.Detail=this}onReady(){window.addEventListener("keydown",this.onKeyDown)}componentWillUnmount(){this.state.ready&&window.removeEventListener("keydown",this.onKeyDown),delete window.Detail}onKeyDown(e){const t=()=>{e.preventDefault(),e.stopPropagation()};if((e.ctrlKey||e.metaKey)&&83===e.keyCode){t();let e=this.props.urlParams;e.editing_mode?e.controller.dataContext.isModified()?e.controller.actionHandler.submit({}):e.controller.history.replaceState({editing_mode:!1}):e.controller.history.replaceState({editing_mode:!0})}else if([33,34,35,36].includes(e.keyCode)&&(""===document.activeElement.value||void 0===document.activeElement.value)){t();let i=this.context.navinfo,s=this.navigate;if(!i)return;33===e.keyCode&&i.prev?s("prev"):34===e.keyCode&&i.next?s("next"):35===e.keyCode&&i.next?s("last"):36===e.keyCode&&i.prev&&s("first")}}render(){return this.state.ready?(0,l.jsx)(this.ex.lc.LinoLayout,{window_layout:this.props.window_layout,wt:n.WINDOW_TYPE_DETAIL}):null}}d.requiredModules=["lc","u"],d.iPool=h,d.contextType=a.DataContextType,d.propTypes={editing_mode:r().bool},d.defaultProps={editing_mode:!1};i(2981);let c;c={_:i.e(5312).then(i.t.bind(i,8452,23)),prButton:Promise.all([i.e(7353),i.e(5155),i.e(7320),i.e(2109),i.e(6839),i.e(968)]).then(i.bind(i,4917)),prColumn:i.e(1295).then(i.bind(i,5433)),prTriStateCheckbox:Promise.all([i.e(1295),i.e(5155),i.e(7320),i.e(2109),i.e(3084)]).then(i.bind(i,9405)),prDataTable:Promise.all([i.e(1295),i.e(7353),i.e(444),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(7973),i.e(4709),i.e(6013),i.e(831)]).then(i.bind(i,6799)),prInputNumber:Promise.all([i.e(1295),i.e(5155),i.e(7320),i.e(2109),i.e(1575)]).then(i.bind(i,7862)),prInputText:Promise.all([i.e(1295),i.e(5155),i.e(7320),i.e(2109),i.e(7894)]).then(i.bind(i,8706)),prMultiSelect:Promise.all([i.e(1295),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(7973),i.e(8934),i.e(193)]).then(i.bind(i,5629)),prOverlayPanel:Promise.all([i.e(9880),i.e(5155),i.e(7320),i.e(4873),i.e(1751)]).then(i.bind(i,1849)),prSelectButton:Promise.all([i.e(444),i.e(5155),i.e(7320),i.e(2109),i.e(2494)]).then(i.bind(i,526)),u:Promise.all([i.e(1295),i.e(3486),i.e(1473),i.e(7353),i.e(532),i.e(6125),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(8934),i.e(2071),i.e(9158),i.e(6622)]).then(i.bind(i,765)),lc:Promise.all([i.e(1295),i.e(3486),i.e(1473),i.e(7353),i.e(532),i.e(6125),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(8934),i.e(2071),i.e(9158),i.e(6622)]).then(i.bind(i,3900)),dt:i.e(5990).then(i.bind(i,9426))};(0,a.RegisterImportPool)(c);class p extends s.Component{constructor(e){super(e),this.state={},this.dragStart=this.dragStart.bind(this),this.drop=this.drop.bind(this)}dragOver(e){e.preventDefault()}dragStart(e){let t,i=e.target;"A"===i.nodeName&&(i=e.target.querySelector("div")),t=i.attributes.pk.value,e.dataTransfer.setData("pk",t)}drop(e){let t=e.dataTransfer.getData("pk"),i=this.props.data.filter((e=>![null,void 0].includes(e)&&"object"==typeof e&&e.meta))[0].calDates[this.props.column.col.fields_index];window.App.runAction({actorId:"cal.Events",an:"drag_drop",sr:[t],rp:window.Detail,status:{data:{start_date:i}}})}render(){return(0,l.jsx)("div",{draggable:!0,onDragOver:this.dragOver,onDragStart:this.dragStart,onDrop:this.drop,children:this.props.children})}}class u extends a.Component{async prepare(){this.ex._=this.ex._.default}constructor(e){super(e),this.state={...this.state,filter:null,value:null,comparison:"exact"},this.comparisonSelect=this.comparisonSelect.bind(this)}onReady(){this.pushFilter=this.ex.u.debounce(this.pushFilter.bind(this),300);let e=this.props.col,t=this.context.gridFilters.get(e.fields_index)||{field:e.name,type:e.filter.type,value:""};["numeric","date"].includes(t.type)&&void 0===t.comparison&&(t.comparison=this.state.comparison),this.context.gridFilters.set(e.fields_index,t),this.setState({filter:t,value:t.value,comparison:t.comparison||this.state.comparison})}comparisonSelect(e){return(0,l.jsx)(this.ex.prSelectButton.SelectButton,{onChange:t=>e({comparison:t.value}),optionLabel:"label",options:[{label:"<",value:"lt"},{label:"==",value:"exact"},{label:">",value:"gt"}],optionValue:"value",style:{textAlign:"center"},value:this.state.comparison})}pushFilter(e){Object.assign(this.state.filter,e);let t=this.context.controller.actionHandler.getGridFilters();this.context.controller.history.replace({[n.URL_PARAM_GRIDFILTER]:this.ex._.cloneDeep(t)})}render(){if(!this.state.ready)return null;if(null===this.state.filter)return null;let e,{col:t}=this.props,i=this.props.ge.filterPanels[t.fields_index];const o=e=>{this.setState(e),this.pushFilter(e)};return"list"===t.filter.type?e=(0,l.jsx)(this.ex.prMultiSelect.MultiSelect,{onChange:e=>o({value:e.target.value}),options:t.filter.options,value:this.state.value}):"string"===t.filter.type?e=(0,l.jsx)(this.ex.prInputText.InputText,{value:this.state.value,onChange:e=>o({value:e.target.value})}):"numeric"===t.filter.type?e=(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)(this.ex.prInputNumber.InputNumber,{value:this.state.value,onChange:e=>o({value:e.value})}),this.comparisonSelect(o)]}):"boolean"===t.filter.type?e=(0,l.jsx)(this.ex.prTriStateCheckbox.TriStateCheckbox,{onChange:e=>o({value:e.value}),value:this.state.value}):"date"===t.filter.type&&(e=(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)(this.ex.dt.DateFilter,{elem:t,parent:this,urlParams:this.context}),this.comparisonSelect(o)]})),(0,l.jsx)("div",{style:this.props.style,onKeyDown:e=>{27===e.keyCode&&i&&(e.stopPropagation(),e.preventDefault(),i.hide())},children:e})}}u.requiredModules=["u","_","prTriStateCheckbox","prInputNumber","prInputText","prMultiSelect","prSelectButton","dt"],u.iPool=c,u.propTypes={col:r().object.isRequired,ge:r().object,style:r().object.isRequired},u.defaultProps={style:{}},u.contextType=a.URLContextType;class m extends a.Component{constructor(e){super(e),this.state={...this.state,columns:null,loading:e.loading},this.data={shiftIndex:null},this.filterPanels={},this.addColHeaderMouseOverEL=this.addColHeaderMouseOverEL.bind(this),this.arrowSelect=this.arrowSelect.bind(this),this.columnEditor=this.columnEditor.bind(this),this.columnTemplate=this.columnTemplate.bind(this),this.demandsFromChildren=this.demandsFromChildren.bind(this),this.handleZoom=this.handleZoom.bind(this),this.keyPaginator=this.keyPaginator.bind(this),this.loadSelectedRows=this.loadSelectedRows.bind(this),this.maintainTableHeight=this.maintainTableHeight.bind(this),this.moveColHeaderTooltip=this.moveColHeaderTooltip.bind(this),this.onBeforeEditorHide=this.onBeforeEditorHide.bind(this),this.onBeforeEditorShow=this.onBeforeEditorShow.bind(this),this.onCancel=this.onCancel.bind(this),this.onColReorder=this.onColReorder.bind(this),this.onEditorInit=this.onEditorInit.bind(this),this.editNextCell=this.editNextCell.bind(this),this.onSubmit=this.onSubmit.bind(this),this.removeColHeaderMouseOverEL=this.removeColHeaderMouseOverEL.bind(this),this.toggleOffColHeaderTooltip=this.toggleOffColHeaderTooltip.bind(this),this.toggleOnColHeaderTooltip=this.toggleOnColHeaderTooltip.bind(this),this.set_cols=this.set_cols.bind(this),this.showDetail=this.showDetail.bind(this)}onReady(){this.set_cols(),this.props.parent.props.inDetail?window.postMessage("GridMount","*"):(window.addEventListener("keydown",this.arrowSelect),window.addEventListener("keydown",this.loadSelectedRows),window.addEventListener("keydown",this.keyPaginator)),this.addColHeaderMouseOverEL(),window.App.registerHandle("zoom",this.handleZoom)}getSnapshotBeforeUpdate(e,t){if(!this.state.ready)return null;let i={};return e.urlParams===this.props.urlParams&&this.props.loading===e.loading||(i.render=!0),Object.keys(i).length?i:null}componentDidUpdate(e,t,i){null!==i&&(this.props.parent.props.inDetail||this.maintainTableHeight(),this.setState({loading:this.props.loading}))}componentWillUnmount(){!this.props.parent.props.inDetail&&this.state.ready&&(window.removeEventListener("keydown",this.arrowSelect),window.removeEventListener("keydown",this.loadSelectedRows),window.removeEventListener("keydown",this.keyPaginator)),this.removeColHeaderMouseOverEL(),window.App.unregisterHandle("zoom",this.handleZoom)}addColHeaderMouseOverEL(){Array.from(document.querySelectorAll("th.l-grid-col")).forEach((e=>{e.addEventListener("mouseenter",this.toggleOnColHeaderTooltip),e.addEventListener("mouseleave",this.toggleOffColHeaderTooltip),e.addEventListener("mousemove",this.moveColHeaderTooltip)}))}loadSelectedRows(e){13===e.keyCode&&this.props.urlParams.sr.length&&(e.stopPropagation(),e.preventDefault(),this.showDetail(e,this.props.urlParams.sr[0]))}arrowSelect(e){if([38,40].includes(e.keyCode)&&!window.App.arrowsTaken&&!this.props.parent.props.inDetail){e.stopPropagation();let t,i,s,o,r,n,a=this.context.rows.length,l=this.props.urlParams.sr,h=this.data.shiftIndex;if(this.props.urlParams.sr.length?e.shiftKey&&null!==h?(s=this.context.pks.indexOf(l.slice(-1)[0]),o=this.context.pks.indexOf(l[0]),o===h?(40===e.keyCode?s<a-1&&(i=this.context.pks.slice(h,s+2)):s>h?i=this.context.pks.slice(h,s):s>0&&(r=!0,i=this.context.pks.slice(s-1,h+1)),r||(n=!0)):(r=!0,40===e.keyCode?i=this.context.pks.slice(o+1,h+1):o>0&&(i=this.context.pks.slice(o-1,h+1)))):38===e.keyCode?(t=this.context.pks.indexOf(l[0]),t>0&&(i=[this.context.pks[t-1]])):(t=this.context.pks.indexOf(l.slice(-1)[0]),t<a-1&&(i=[this.context.pks[t+1]])):i=38===e.keyCode?this.context.pks.slice(-1):[this.context.pks[0]],i){e.shiftKey||(40===e.keyCode?this.data.shiftIndex=this.context.pks.indexOf(i[0]):this.data.shiftIndex=this.context.pks.indexOf(i.slice(-1)[0])),this.props.urlParams.controller.history.replace({sr:i}),this.props.parent.setState({loading:!1});let t=Array.from(this.dataTable.getElement().querySelectorAll("tr.p-highlight")),s=this.dataTable.getElement().getBoundingClientRect();if(!t.length)return;let o=t.slice(-1)[0].getBoundingClientRect().bottom-s.bottom>0,a=t[0].getBoundingClientRect().top-s.top<0;if(o||a){let e="nearest";n&&(t=t.slice(-1)[0]),r&&(t=t[0]),a&&n&&(e="end"),o&&r&&(e="start"),t.length&&(t=t[0]),t.scrollIntoView({block:e,behaviour:"smooth"})}}}}keyPaginator(){if([33,34,35,36].includes(event.keyCode)&&!window.App.arrowsTaken&&!this.props.parent.props.inDetail){event.preventDefault();let e=this.props.urlParams[n.URL_PARAM_START]||0,t=e+this.props.urlParams[n.URL_PARAM_LIMIT],i=this.context.pageCount*this.props.urlParams[n.URL_PARAM_LIMIT];33===event.keyCode?e&&this.props.urlParams.controller.history.replace({[n.URL_PARAM_START]:e-this.context.rows.length}):34===event.keyCode?t<=i&&this.props.urlParams.controller.history.replace({[n.URL_PARAM_START]:t}):35===event.keyCode?this.props.urlParams.controller.history.replace({[n.URL_PARAM_START]:i}):36===event.keyCode&&this.props.urlParams.controller.history.replace({[n.URL_PARAM_START]:0})}}editNextCell(e){if([36,35,46].includes(e.keyCode)&&e.stopPropagation(),"Enter"===e.key){let t=e.target.closest("tr");t=e.shiftKey?t.previousSibling:t.nextSibling,t&&t.children[Array.prototype.indexOf.call(e.target.closest("tr").childNodes,e.target.closest("td"))].click()}if("Tab"===e.key){let t=e.target.closest("table"),i=Array.from(t.getElementsByClassName("p-cell-editor-key-helper")),s=i.findIndex((t=>t.parentElement.contains(e.target)));s=e.shiftKey?s-1:s+1,i[s].click()}}removeColHeaderMouseOverEL(){Array.from(document.querySelectorAll("th.l-grid-col")).forEach((e=>{e.removeEventListener("mouseenter",this.toggleOnColHeaderTooltip),e.removeEventListener("mouseleave",this.toggleOffColHeaderTooltip),e.removeEventListener("mousemove",this.moveColHeaderTooltip)}))}toggleOnColHeaderTooltip(e){let t=this.props.urlParams.static.actorData.col.filter((t=>t.fields_index===Array.from(this.props.urlParams.showableColumns.keys())[e.target.cellIndex-1]))[0];if(t&&t.help_text){let i=e.target.closest("div.l-grid").querySelector("span.l-col-header-helptext");this.data.chEl=i,i.style.display="block",i.innerText=t.help_text}}toggleOffColHeaderTooltip(e){let t=e.target.closest("div.l-grid").querySelector("span.l-col-header-helptext");t.style.display="none",t.innerText="",delete this.data.chEl}moveColHeaderTooltip(e){this.data.chEl&&(this.data.chEl.style.left=(e.x-120).toString()+"px",this.data.chEl.style.top=(e.y+25).toString()+"px")}handleZoom(){let e=document.querySelector(".p-paginator.p-component"),t=this.dataTable.getElement().children[0].children[0],i=t.children[1],s=window.innerHeight-(window.App.state.site_data.top_paginator||!e?t.children[2].getBoundingClientRect().bottom:e.getBoundingClientRect().bottom),o=i.scrollHeight/this.context.rows.length,r=i.scrollHeight-i.clientHeight;r?r>=o&&this.props.urlParams.controller.history.replace({[n.URL_PARAM_START]:0,[n.URL_PARAM_LIMIT]:Math.round(i.clientHeight/o)}):s>=o&&this.props.urlParams.controller.history.replace({[n.URL_PARAM_START]:0,[n.URL_PARAM_LIMIT]:this.context.rows.length+Math.round(s/o)})}maintainTableHeight(){let e=this.dataTable.getElement().children[0].children[0];if(!e.children[0])return;let t=window.innerHeight-e.children[0].getBoundingClientRect().bottom;if(!window.App.state.site_data.top_paginator){let e=document.querySelector(".p-paginator.p-component");e&&(t-=e.getBoundingClientRect().height)}t<300&&(t=300),e.children[1].style.setProperty("max-height",t.toString()+"px")}demandsFromChildren(e){this.data.roger=e}onColReorder(e){let t=new Map;e.columns.filter((e=>!this.ex.u.isNaN(parseInt(e.props.field)))).forEach(((e,i)=>{t.set(parseInt(e.props.field),e.props.name)})),this.props.urlParams.controller.history.replace({showableColumns:t})}onBeforeEditorHide(e,t){}onBeforeEditorShow(e){}onEditorInit(e){}onSubmit({rowIndex:e,originalEvent:t}){"click"===t.type&&t.ctrlKey||this.props.urlParams.controller.actionHandler.submit({cellInfo:{rowIndex:e}})}onCancel(e){console.log("Cancelled!")}columnEditor(e){if(this.props.urlParams.static.actorData.editable&&e.editable)return t=>{const i={hide_label:!0,[n.URL_PARAM_WINDOW_TYPE]:n.WINDOW_TYPE_TABLE,column:t,editing_mode:!0,tabIndex:Math.max(...Array.from(this.props.urlParams.showableColumns.keys()))*t.rowIndex+e.fields_index};return(0,l.jsx)("div",{onKeyDown:this.editNextCell,children:(0,l.jsx)(this.ex.lc.LinoLayout,{...i,elem:e})})}}columnTemplate(e){let t={},i="calview"===this.props.packId;return i||(t={overflow:"hidden"}),(o,r)=>{let a,h="l-row-view l-centered-container",d=o[this.props.urlParams.static.actorData.pk_index];0===parseInt(r.field)&&this.props.urlParams.sr.includes(d)&&(this.context.pks.indexOf(d)>0?h+=" l-rv-top":h+=" l-rv-bottom",a=(0,l.jsx)("div",{style:{position:"absolute"},children:(0,l.jsx)("div",{className:h,children:(0,l.jsx)("div",{className:"l-centered",children:(0,l.jsx)("span",{className:"l-span-clickable",onClick:e=>this.showDetail(e,d),children:"♂"})})})}));const c={editing_mode:!1,hide_label:!0,[n.URL_PARAM_WINDOW_TYPE]:n.WINDOW_TYPE_TABLE,column:r,tabIndex:Math.max(...Array.from(this.props.urlParams.showableColumns.keys()))*r.rowIndex+e.fields_index};let u=(0,l.jsx)(this.ex.lc.LinoLayout,{...c,elem:e});return i&&(u=(0,l.jsx)(p,{...c,children:u})),(0,l.jsxs)(s.Fragment,{children:[a,(0,l.jsx)("div",{style:t,children:u})]})}}rowClassName(e){if(!Array.isArray(e))return{};let t=e.filter((e=>![null,void 0].includes(e)&&"object"==typeof e&&e.meta))[0],i={};return t&&t.hasOwnProperty("styleClass")?(i[t.styleClass]=!0,i):void 0}set_cols(){if(void 0===this.props.urlParams.static.actorData.col)return;let e={verticalAlign:"baseline"};"calview"===this.props.packId&&(e.padding="0");let t=0===this.props.urlParams.static.actorData.preview_limit?[]:["SelectCol"];t=t.concat(this.props.urlParams.static.actorData.col.filter((e=>this.props.urlParams.showableColumns.has(e.fields_index)))).map(((t,i)=>{let o=t.width||t.preferred_width;return o<10&&(o=10),o&&(o=o.toString()+"ch"),"SelectCol"===t?(0,l.jsx)(this.ex.prColumn.Column,{selectionMode:"multiple",align:"center",style:{width:"2em",padding:"unset",textAlign:"center"}},i):(0,l.jsx)(this.ex.prColumn.Column,{body:this.columnTemplate(t),cellIndex:i,className:`l-grid-col l-grid-col-${t.name} ${this.data.editingCellIndex===i?"p-cell-editing":""}`,col:t,editor:this.columnEditor(t),field:String(t.fields_index),name:t.name,header:(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{className:"col-header-label",value:t.fields_index,children:t.label}),t.hasOwnProperty("filter")&&(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)("span",{children:"  "}),"boolean"===t.filter.type?(0,l.jsx)(u,{style:{display:"inline"},col:t,ge:this}):(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)(this.ex.prButton.Button,{icon:"pi pi-filter",onClick:e=>{this.filterPanels[t.fields_index].toggle(e),e.stopPropagation()}}),(0,l.jsx)(this.ex.prOverlayPanel.OverlayPanel,{ref:e=>this.filterPanels[t.fields_index]=e,children:(0,l.jsx)(u,{col:t,ge:this})})]})]})]}),headerStyle:{width:o},id:t.fields_index.toString()+t.name,onBeforeCellEditHide:this.onBeforeEditorHide,onBeforeCellEditShow:this.onBeforeEditorShow,onCellEditCancel:this.onCancel,onCellEditComplete:this.onSubmit,onCellEditInit:this.onEditorInit,sortable:t.sortable,style:e},i)})),this.setState({columns:t})}showDetail(e,t){this.props.urlParams.controller.actionHandler.singleRow(e,t)}render(){if(!this.state.ready||!this.state.columns||!this.context.success)return null;let e="checkbox";return"calview"===this.props.packId&&(e=null),(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)("span",{className:"l-col-header-helptext"}),(0,l.jsx)(this.ex.prDataTable.DataTable,{emptyMessage:this.context.no_data_text,lazy:!0,loading:this.state.loading,onColReorder:this.onColReorder,onRowDoubleClick:this.showDetail,onSelectionChange:e=>{let t=e.value.map((e=>e[this.props.urlParams.static.actorData.pk_index]));this.props.urlParams.controller.history.replace({sr:t}),this.props.parent.setState({loading:!1})},onSort:({sortField:e,sortOrder:t})=>this.props.urlParams.controller.history.replace({[n.URL_PARAM_SORT]:this.props.urlParams.showableColumns.get(parseInt(e)),[n.URL_PARAM_SORTDIR]:1===t?"ASC":"DESC",sortField:e,sortOrder:t}),paginator:!1,ref:e=>{this.dataTable=e},reorderableColumns:!0,resizableColumns:!0,rowClassName:this.rowClassName,scrollable:!0,scrollHeight:this.props.parent.props.inDetail?"":(window.innerHeight-document.querySelector("div.l-grid").getBoundingClientRect().top-105).toString()+"px",selection:this.context.rows.filter((e=>this.props.urlParams.sr.includes(e[this.props.urlParams.static.actorData.pk_index]))),selectionMode:e,sortField:this.props.urlParams.sortField,sortOrder:this.props.urlParams.sortOrder,stripedRows:!0,value:this.context.rows,children:this.state.columns})]})}}m.requiredModules=["prButton","prColumn","prDataTable","prOverlayPanel","lc","u"],m.iPool=c,m.contextType=a.DataContextType,m.propTypes={loading:r().bool.isRequired,parent:r().object.isRequired,urlParams:r().object.isRequired};i(8880);let x;x={prCard:Promise.all([i.e(9880),i.e(5155)]).then(i.bind(i,5268)),prDataView:Promise.all([i.e(1295),i.e(444),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(7973),i.e(6013),i.e(8206)]).then(i.bind(i,2372)),prGalleria:Promise.all([i.e(444),i.e(5155),i.e(7320),i.e(4873),i.e(4271)]).then(i.bind(i,8567)),u:Promise.resolve().then(i.bind(i,765)),lc:Promise.all([i.e(1295),i.e(3486),i.e(1473),i.e(7353),i.e(532),i.e(6125),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(8934),i.e(2071),i.e(9158),i.e(6622)]).then(i.bind(i,3900))};(0,a.RegisterImportPool)(x);class g extends a.Component{constructor(e){super(e),this.itemTemplate=this.itemTemplate.bind(this)}itemTemplate(e,t){const i=e.main_card_body?(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:e.main_card_body}}):(0,l.jsx)(a.DataContextType.Provider,{value:e,children:(0,l.jsx)(this.ex.lc.LinoLayout,{editing_mode:!1,window_layout:this.props.urlParams.static.actorData.card_layout,wt:n.WINDOW_TYPE_CARDS})});let s=e.card_title;return s=s.startsWith("<a")?(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:s}}):(0,l.jsxs)("p",{children:[e.card_title,(0,l.jsx)("span",{className:"l-span-clickable",onClick:t=>{this.props.urlParams.controller.actionHandler.singleRow(null,e.id)},children:(0,l.jsx)("i",{className:"pi pi-link"})})]}),(0,l.jsx)(this.ex.prCard.Card,{title:s,style:{margin:"20px"},children:i})}render(){return this.state.ready?(0,l.jsx)(this.ex.prDataView.DataView,{emptyMessage:this.context.no_data_text,value:this.context.rows,layout:"grid",itemTemplate:this.itemTemplate}):null}}g.requiredModules=["prCard","prDataView","lc","u"],g.iPool=x,g.contextType=a.DataContextType;class _ extends a.Component{constructor(e){super(e),this.state={activeIndex:0}}imageTemplate(e){return(0,l.jsx)("img",{src:e.image_src,style:{maxWidth:"100%",maxHeight:"100%"}})}thumbnailTemplate(e){return(0,l.jsx)("img",{src:e.thumbnail_src,style:{width:"12ch",padding:"5px"}})}render(){return this.state.ready?(0,l.jsxs)("div",{className:"card l-gallery",children:[(0,l.jsx)(this.ex.prGalleria.Galleria,{activeIndex:this.state.activeIndex,circular:!0,fullScreen:!0,item:this.imageTemplate,onItemChange:e=>this.setState({activeIndex:e.index}),ref:e=>this.galleria=e,showItemNavigators:!0,showIndicators:!0,showIndicatorsOnItem:!0,showThumbnails:!1,style:{maxWidth:"75%"},value:this.context.rows}),(0,l.jsx)("div",{className:"p-grid",children:this.context.rows&&this.context.rows.map(((e,t)=>(0,l.jsxs)("div",{style:{position:"relative"},children:[e.hasOwnProperty("memo_cmd")&&(0,l.jsx)("span",{className:"l-span-clickable",title:"Copy memo command",style:{position:"absolute",background:"yellow",right:"7px",top:"7px",width:"2.2ch",textAlign:"center",borderRadius:"3px",color:"forestgreen"},onClick:t=>{navigator.clipboard.writeText(e.memo_cmd),this.props.urlParams.controller.APP.toast.show({severity:"info",summary:"Info",detail:`Memo command (${e.memo_cmd}) has been copied to clipboard`})},children:(0,l.jsx)("i",{className:"pi pi-copy"})}),(0,l.jsx)("img",{style:{maxWidth:"20ch",maxHeight:"35ch",padding:"5px"},onClick:()=>{this.setState({activeIndex:t},(()=>this.galleria.show()))},src:e.image_src})]},t)))})]}):null}}_.requiredModules=["prGalleria"],_.iPool=x,_.contextType=a.DataContextType;let P;P={prButton:Promise.all([i.e(7353),i.e(5155),i.e(7320),i.e(2109),i.e(6839),i.e(968)]).then(i.bind(i,4917)),prDropDown:Promise.all([i.e(444),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(7973)]).then(i.bind(i,367)),prOverlayPanel:Promise.all([i.e(9880),i.e(5155),i.e(7320),i.e(4873),i.e(1751)]).then(i.bind(i,1849)),prPaginator:Promise.all([i.e(1295),i.e(444),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(7973),i.e(6013)]).then(i.bind(i,3637)),prSlider:Promise.all([i.e(5155),i.e(2201)]).then(i.bind(i,3856)),u:Promise.resolve().then(i.bind(i,765))};(0,a.RegisterImportPool)(P);class y extends a.Component{constructor(e){super(e),this.state={...this.state,slider:e.slider||!1,sliderDisabled:!1,sliderShowing:!1,sliderValue:1},this.findRowDiff=this.findRowDiff.bind(this),this.getRowsPerPage=this.getRowsPerPage.bind(this),this.setRowsPerPage=this.setRowsPerPage.bind(this)}findRowDiff(e){if(0===e)return 0;let t=this.context.controller.dataContext.mutableContext.count,i=this.context[n.URL_PARAM_LIMIT],s=i/t;return e>0?Math.round((t-i)**e):e<s?-1*Math.round(i**(-1*e)):0}getRowsPerPage(e){let t=this.context[n.URL_PARAM_LIMIT]+this.findRowDiff(e);return 0===t?(this.setState({sliderValue:1}),window.App.toast.show({severity:"warn",summary:"URL_PARAM_LIMIT = 0; (not allowed!)"}),null):t===this.context[n.URL_PARAM_LIMIT]?(this.setState({sliderValue:1}),null):t}setRowsPerPage(e){null!=e&&(this.setState({sliderValue:1}),this.context.controller.history.replace({[n.URL_PARAM_START]:0,[n.URL_PARAM_LIMIT]:e}))}render(){if(!this.state.ready)return null;let e=this.context.controller.dataContext.mutableContext.count;if(0===this.context.static.actorData.preview_limit||0===e||void 0===e||this.context.static.actorData.simple_paginator)return null;let t=this.context[n.URL_PARAM_LIMIT];return(0,l.jsx)("div",{ref:e=>this.container=e,children:(0,l.jsx)(this.ex.prPaginator.Paginator,{alwaysShow:!0,rows:t,first:this.context[n.URL_PARAM_START]||0,totalRecords:e,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",onPageChange:e=>{this.context.controller.history.replace({[n.URL_PARAM_START]:e.page*t})},ref:e=>this.pg=e,rightContent:e&&(0,l.jsxs)("span",{className:"l-grid-count",children:["Showing ",this.state.slider?(0,l.jsxs)(s.Fragment,{children:[!this.state.sliderShowing&&(0,l.jsx)(this.ex.prButton.Button,{disabled:1===e,icon:"pi pi-minus",onClick:e=>this.setRowsPerPage(t-1),type:"button"}),(0,l.jsx)(this.ex.prButton.Button,{label:this.state.sliderShowing?(t+this.findRowDiff(this.state.sliderValue-1)).toString():Math.min(t,e).toString(),onClick:e=>{this.setState({sliderShowing:!this.state.sliderShowing}),this.sliderPanel.toggle(e)},type:"button"}),!this.state.sliderShowing&&(0,l.jsx)(this.ex.prButton.Button,{disabled:e===t,icon:"pi pi-plus",onClick:e=>this.setRowsPerPage(t+1),type:"button"}),(0,l.jsx)(this.ex.prOverlayPanel.OverlayPanel,{dismissable:!0,onHide:e=>this.setState({sliderShowing:!1}),ref:e=>this.sliderPanel=e,children:(0,l.jsx)(this.ex.prSlider.Slider,{disabled:this.state.sliderDisabled,max:2,min:0,onChange:e=>{"click"===e.originalEvent.type?this.setRowsPerPage(this.getRowsPerPage(e.value-1)):this.setState({sliderValue:e.value})},onSlideEnd:e=>this.setRowsPerPage(this.getRowsPerPage(e.value-1)),orientation:"vertical",step:1/e,value:this.state.sliderValue})})]}):(0,l.jsx)(this.ex.prDropDown.Dropdown,{style:{width:"80px"},value:t,placeholder:t.toString(),options:[15,25,50,100,200,400,800],onChange:e=>{this.setRowsPerPage(e.value)}}),(0,l.jsxs)("span",{children:[" of ",e]})," rows"]})})})}}y.requiredModules=["prButton","prDropDown","prOverlayPanel","prPaginator","prSlider","u"],y.iPool=P,y.contextType=a.URLContextType;let b;b={u:Promise.resolve().then(i.bind(i,765)),lc:Promise.all([i.e(1295),i.e(3486),i.e(1473),i.e(7353),i.e(532),i.e(6125),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(8934),i.e(2071),i.e(9158),i.e(6622)]).then(i.bind(i,3900))};function A(e){const t=s.useContext(a.URLContextType);if(!t.static.actorData.params_layout)return null;const i=(0,a.getExReady)(b,["u","lc"]);return i.ready?(0,l.jsx)("div",{hidden:!t.pvPVisible,className:"l-params-panel l-header",children:(0,l.jsx)(i.lc.LinoLayout,{editing_mode:!0,window_layout:t.static.actorData.params_layout,wt:n.WINDOW_TYPE_PARAMS})}):null}(0,a.RegisterImportPool)(b);i(1616);let w;w={AbortController:i.e(1473).then(i.t.bind(i,4862,23)),prButton:Promise.all([i.e(7353),i.e(5155),i.e(7320),i.e(2109),i.e(6839),i.e(968)]).then(i.bind(i,4917)),prInputText:Promise.all([i.e(1295),i.e(5155),i.e(7320),i.e(2109),i.e(7894)]).then(i.bind(i,8706)),prOverlayPanel:Promise.all([i.e(9880),i.e(5155),i.e(7320),i.e(4873),i.e(1751)]).then(i.bind(i,1849)),prMultiSelect:Promise.all([i.e(1295),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(7973),i.e(8934),i.e(193)]).then(i.bind(i,5629)),prSelectButton:Promise.all([i.e(444),i.e(5155),i.e(7320),i.e(2109),i.e(2494)]).then(i.bind(i,526)),prSplitButton:Promise.all([i.e(9880),i.e(7353),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(5419)]).then(i.bind(i,5253)),prToggleButton:Promise.all([i.e(444),i.e(5155),i.e(7320),i.e(2109),i.e(6905)]).then(i.bind(i,1577)),u:Promise.resolve().then(i.bind(i,765)),bb:Promise.resolve().then(i.bind(i,3670)),lm:Promise.resolve().then(i.bind(i,552)),ac:Promise.all([i.e(1295),i.e(3486),i.e(1473),i.e(7353),i.e(5155),i.e(7320),i.e(2109),i.e(4873),i.e(6839),i.e(488),i.e(8934),i.e(9158),i.e(3756)]).then(i.t.bind(i,9158,23))};function D(e){const t=s.useContext(a.URLContextType),i=(0,a.getExReady)(w,["prSelectButton","u"]);let o=[];return(t.static.actorData.card_layout||t.static.actorData.list_layout||t.static.actorData.contain_media)&&(t.hasDetail&&o.push({icon:"pi-file-o",help:"Detail View",value:n.DISPLAY_MODE_DETAIL}),t.static.actorData.contain_media&&o.push({icon:"pi-clone",help:"Gallery View",value:n.DISPLAY_MODE_GALLERY}),o.push({icon:"pi-map",help:"Story View",value:n.DISPLAY_MODE_STORY}),o.push({icon:"pi-bars",help:"List View",value:n.DISPLAY_MODE_LIST}),t.static.actorData.card_layout&&o.push({icon:"pi-th-large",help:"Card View",value:n.DISPLAY_MODE_CARDS}),o.push({icon:"pi-table",help:"Table View",value:n.DISPLAY_MODE_TABLE})),e.parent.props.inDetail&&t.static.actorData.editable&&o.push({icon:"pi-external-link",help:"Extend window",value:"external"}),i.ready?(0,l.jsx)(i.prSelectButton.SelectButton,{itemTemplate:e=>(0,l.jsx)("i",{title:e.help,className:"pi "+e.icon}),onChange:e=>((e,i)=>{let s=t.controller;const o=e=>{s.isModified()?s.actionHandler.discardModDConfirm({agree:e}):e()};switch(e){case n.DISPLAY_MODE_DETAIL:if(s.contextType===n.CONTEXT_TYPE_SINGLE_ROW)return;if(0===t.sr.length){let e,r=s.dataContext.mutableContext.rows[0];r&&(e=r.hasOwnProperty("id")?r.id:"object"==typeof r?r[t.static.actorData.pk_index]:null),null===e?s.history.replaceState({hasDetail:!1}):o((()=>s.actionHandler.singleRow(i,e)))}else o((()=>s.actionHandler.singleRow(i,t.sr[0])));break;case"external":o((()=>s.actionHandler.multiRow({},s.parent)));break;case n.DISPLAY_MODE_TABLE:case n.DISPLAY_MODE_CARDS:case n.DISPLAY_MODE_LIST:case n.DISPLAY_MODE_GALLERY:case n.DISPLAY_MODE_STORY:s.contextType===n.CONTEXT_TYPE_SINGLE_ROW?o((()=>s.actionHandler.multiRow({[n.URL_PARAM_DISPLAY_MODE]:e}))):o((()=>s.history.replace({[n.URL_PARAM_DISPLAY_MODE]:e})))}})(e.value,e),options:o,value:t[n.URL_PARAM_DISPLAY_MODE]}):null}(0,a.RegisterImportPool)(w);class v extends a.Component{constructor(e){super(e),this.state={...this.state,query:e.query||""},this.renderActionBar=this.renderActionBar.bind(this),this.renderDataViewSortButton=this.renderDataViewSortButton.bind(this),this.renderDetailNavigator=this.renderDetailNavigator.bind(this),this.renderEditorButton=this.renderEditorButton.bind(this),this.renderParamValueControls=this.renderParamValueControls.bind(this),this.renderQuickFilter=this.renderQuickFilter.bind(this),this.renderToggle_colControls=this.renderToggle_colControls.bind(this)}onReady(){this.controller=new this.ex.AbortController.default}renderActionBar(e,t){return(0,l.jsx)(this.ex.bb.LinoBbar,{onSide:e,nonCollapsibles:t,an:this.context[n.URL_PARAM_DISPLAY_MODE]===n.DISPLAY_MODE_DETAIL?"show"===this.context.static.actorData.default_action?"show":"detail":"grid"})}renderDataViewSortButton(){if(this.context[n.URL_PARAM_DISPLAY_MODE]===n.DISPLAY_MODE_DETAIL)return;const e=this.context.static.actorData.col.map((e=>({label:e.name,value:String(e.fields_index),command:e=>{let t=parseInt(e.item.value);this.context.controller.history.replace({[n.URL_PARAM_SORT]:this.context.showableColumns.get(t),[n.URL_PARAM_SORTDIR]:"DESC",sortField:t,sortOrder:1})}})));return(0,l.jsx)(this.ex.prSplitButton.SplitButton,{icon:0===this.context.sortOrder?"pi pi-sort-alt":1===this.context.sortOrder?"pi pi-sort-amount-up":"pi pi-sort-amount-down",label:"Sort By: "+(this.context[n.URL_PARAM_SORT]||""),model:e,onClick:e=>{let t=1===this.context.sortOrder?-1:1;this.context.controller.history.replace({[n.URL_PARAM_SORTDIR]:1===t?"DESC":"ASC",sortOrder:t})},style:{verticalAlign:"bottom"}})}renderDetailNavigator(){if(this.context[n.URL_PARAM_DISPLAY_MODE]!==n.DISPLAY_MODE_DETAIL)return null;let e=this.context.controller.dataContext.mutableContext.navinfo,t=this.props.parent.state.loading;const i=e=>{this.props.parent.LinoDetail.navigate(e)};return e&&(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)(this.ex.prButton.Button,{disabled:t||null===e.prev,className:"l-nav-first",icon:"pi pi-angle-double-left",onClick:e=>i("first")}),(0,l.jsx)(this.ex.prButton.Button,{disabled:t||null===e.prev,className:"l-nav-prev",icon:"pi pi-angle-left",onClick:e=>i("prev")}),(0,l.jsx)(this.ex.prButton.Button,{disabled:t||null===e.next,className:"l-nav-next",icon:"pi pi-angle-right",onClick:e=>i("next")}),(0,l.jsx)(this.ex.prButton.Button,{disabled:t||null===e.next,className:"l-nav-last",icon:"pi pi-angle-double-right",onClick:e=>i("last")})]})}renderEditorButton(){return this.context[n.URL_PARAM_DISPLAY_MODE]!==n.DISPLAY_MODE_DETAIL||!this.context.static.actorData.editable||this.context.static.actorData.edit_safe||this.context.controller.dataContext.contextBackup.disable_editing?null:(0,l.jsx)(this.ex.prToggleButton.ToggleButton,{checked:!this.context.editing_mode,className:"l-bbar-editor-button",onChange:e=>{this.context.controller.history.replaceState({editing_mode:!this.context.editing_mode})},onLabel:"",offLabel:"",offIcon:"pi pi-times",onIcon:"pi pi-pencil",tooltip:this.context.editing_mode?"Cancel":"Edit",tooltipOptions:{position:"bottom"}})}renderParamValueControls(){return this.context.static.actorData.params_layout&&(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)(this.ex.prButton.Button,{icon:"pi pi-sliders-h",onClick:e=>{this.context.controller.history.replace({pvPVisible:!this.context.pvPVisible})},tooltip:this.context.pvPVisible?"Hide parameters panel":"Show parameters panel",tooltipOptions:{position:"bottom"}}),0!==Object.keys(this.context.pv||{}).length&&(0,l.jsx)(this.ex.prButton.Button,{icon:"pi pi-times-circle",onClick:()=>{let e=this.context.controller;e.dataContext.updateState({param_values:{...e.dataContext.contextBackup.param_values}}),e.history.replace({pv:[]})},tooltip:"Clear and set the parameter values to default",tooltipOptions:{position:"bottom"}})]})}renderQuickFilter(e){return(0,l.jsx)("span",{onKeyDown:e=>{46===e.keyCode&&e.stopPropagation()},children:this.context[n.URL_PARAM_DISPLAY_MODE]===n.DISPLAY_MODE_DETAIL?(0,l.jsx)(this.ex.ac.QuickFilter,{urlParams:this.context,wide:!!e}):(0,l.jsx)(this.ex.prInputText.InputText,{className:"l-grid-quickfilter",onChange:e=>{let t=e.target.value;this.setState({query:t}),this.props.parent.quickFilter({query:t})},placeholder:"QuickSearch",ref:e=>{e&&this.context.currentInputWindowType===n.WINDOW_TYPE_UNKNOWN&&0===this.context.currentInputTabIndex&&e.focus()},style:{width:e?"100%":void 0,marginRight:e?"1ch":void 0,marginLeft:e?"1ch":void 0},value:this.state.query})})}renderToggle_colControls(){return this.context[n.URL_PARAM_DISPLAY_MODE]!==n.DISPLAY_MODE_TABLE?null:(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)(this.ex.prButton.Button,{icon:"pi pi-list",onClick:e=>this.col_selector_op.toggle(e),tooltip:"Configure visibility of the grid columns",tooltipOptions:{position:"bottom"}}),(0,l.jsx)(this.ex.prOverlayPanel.OverlayPanel,{onHide:e=>this.col_selector.hide(),onShow:e=>this.col_selector.show(),ref:e=>this.col_selector_op=e,children:(0,l.jsx)(this.ex.prMultiSelect.MultiSelect,{panelStyle:{zIndex:"99999",height:"auto",width:"auto",position:"absolute"},value:Array.from(this.context.showableColumns.keys()),options:this.context.static.actorData.col.map((e=>({label:e.label,value:e.fields_index}))),onChange:e=>{let t=new Map;e.value.forEach(((e,i)=>{t.set(e,this.context.static.actorData.col.find((t=>t.fields_index===e)).name)})),this.context.controller.history.replace({showableColumns:t}),this.props.parent.GridElement.set_cols()},onHide:e=>this.col_selector_op.hide(),ref:e=>this.col_selector=e})})]})}render(){return this.state.ready?(0,l.jsxs)(s.Fragment,{children:[this.context.toolbarState==n.TOOLBAR_STATE_VISIBLE?(0,l.jsx)(s.Fragment,{children:(0,l.jsxs)("div",{className:"table-header",children:[(0,l.jsxs)("div",{className:"l-bbar-left",style:{background:"transparent"},children:[!this.context.static.actorData.hide_navigator&&(0,l.jsxs)(s.Fragment,{children:[this.renderQuickFilter(),this.renderParamValueControls(),this.context[n.URL_PARAM_DISPLAY_MODE]!==n.DISPLAY_MODE_TABLE?this.renderDataViewSortButton():this.renderToggle_colControls(),this.renderDetailNavigator()]}),this.renderActionBar(!1),this.renderEditorButton()]}),(0,l.jsx)(D,{parent:this.props.parent})]})}):this.props.side?(0,l.jsxs)(s.Fragment,{children:[!this.context.static.actorData.hide_navigator&&(0,l.jsxs)(s.Fragment,{children:[this.renderDetailNavigator(),this.context[n.URL_PARAM_DISPLAY_MODE]===n.DISPLAY_MODE_TABLE&&this.renderToggle_colControls()]}),this.renderActionBar(!0),this.renderEditorButton()]}):!this.context.static.actorData.hide_top_toolbar&&this.context.toolbarState==n.TOOLBAR_STATE_PARTIALLY_VISIBLE&&(0,l.jsx)(s.Fragment,{children:(0,l.jsxs)("div",{className:"table-header",children:[(0,l.jsxs)("div",{className:"l-bbar-left",style:{background:"transparent"},children:[!this.context.static.actorData.hide_navigator&&(0,l.jsxs)(s.Fragment,{children:[this.renderQuickFilter(),this.renderParamValueControls(),this.context[n.URL_PARAM_DISPLAY_MODE]!==n.DISPLAY_MODE_TABLE&&this.renderDataViewSortButton()]}),this.renderActionBar(!1,!0)]}),(0,l.jsx)(D,{parent:this.props.parent})]})}),!this.props.side&&(0,l.jsx)(this.ex.lm.LinoProgressBar,{loading:this.props.parent.state.loading})]}):null}}v.requiredModules=["AbortController","prButton","prInputText","prOverlayPanel","prMultiSelect","prSplitButton","prToggleButton","bb","lm","u","ac"],v.iPool=w,v.contextType=a.URLContextType;const R="LinoBody";let f;f={_:i.e(5312).then(i.t.bind(i,8452,23)),AbortController:i.e(1473).then(i.t.bind(i,4862,23)),classNames:i.e(1473).then(i.t.bind(i,4507,23)),prButton:Promise.all([i.e(7353),i.e(5155),i.e(7320),i.e(2109),i.e(6839),i.e(968)]).then(i.bind(i,4917)),u:Promise.resolve().then(i.bind(i,765)),sc:Promise.resolve().then(i.bind(i,4069))};(0,a.RegisterImportPool)(f);class S extends a.Component{constructor(e){super(e),this.state={...this.state,context:{success:!1},loading:!0},this.data={urlParams:null},this.get_current_grid_config=this.get_current_grid_config.bind(this),this.messageInterceptor=this.messageInterceptor.bind(this),this.registerScroll=this.registerScroll.bind(this),this.onKeyDown=this.onKeyDown.bind(this)}async prepare(){this.ex._=this.ex._.default,this.data.urlParams=this.context.controller.copy(),this.DataContext=new this.ex.sc.DataContext({root:this,context:{success:!1},next:()=>{if(this.state.context=this.DataContext.mutableContext,this.quickFilter=this.ex.u.debounce(this.quickFilter.bind(this),300),this.context.controller.attachDataContext(this.DataContext),this.controller=new this.ex.AbortController.default,this.context.controller.actionHandler.load(),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("message",this.messageInterceptor),!this.props.inDetail){window.addEventListener("scroll",this.registerScroll);let e=this.context.controller.APP.router.history.location.pathname,t=window.App.data.scrollIndex,i=t.indexOf(e);i>=0?t.pop(i):t.length>=99&&(t.pop(0),delete window.App.data.scroll[e]),t.push(e)}}})}registerScroll(e){this.firstScrollIngonred?window.App.data.scroll[this.context.controller.APP.router.history.location.pathname]=Object.assign({},{scrollX:window.scrollX,scrollY:window.scrollY}):this.firstScrollIngonred=!0}getSnapshotBeforeUpdate(e,t){let i={};return this.context.noreload&&!this.data.urlParams.noreload?i.render=!0:this.data.urlParams[n.URL_PARAM_DISPLAY_MODE]!==this.context[n.URL_PARAM_DISPLAY_MODE]||this.data.urlParams.path!==this.context.path?i.reload=!0:this.data.urlParams[n.URL_PARAM_START]===this.context[n.URL_PARAM_START]&&this.data.urlParams[n.URL_PARAM_LIMIT]===this.context[n.URL_PARAM_LIMIT]&&this.data.urlParams[n.URL_PARAM_MASTER_PK]===this.context[n.URL_PARAM_MASTER_PK]&&this.data.urlParams[n.URL_PARAM_MASTER_TYPE]===this.context[n.URL_PARAM_MASTER_TYPE]&&this.data.urlParams[n.URL_PARAM_SORT]===this.context[n.URL_PARAM_SORT]&&this.data.urlParams[n.URL_PARAM_SORTDIR]===this.context[n.URL_PARAM_SORTDIR]&&this.data.urlParams[n.URL_PARAM_FILTER]===this.context[n.URL_PARAM_FILTER]&&this.ex._.isEqual(this.data.urlParams.pv,this.context.pv)&&this.ex._.isEqual(this.data.urlParams[n.URL_PARAM_GRIDFILTER],this.context[n.URL_PARAM_GRIDFILTER])||(i.refresh=!0),Object.keys(i).length?(this.data.urlParams=this.context.controller.copy(),i):null}componentDidUpdate(e,t,i){null!==i&&(i.reload?this.context.controller.actionHandler.reload():i.refresh?this.context.controller.actionHandler.refresh():i.render&&this.setState({loading:!1}))}componentWillUnmount(){this.controller.abort(),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("message",this.messageInterceptor),this.props.inDetail||window.removeEventListener("scroll",this.registerScroll)}messageInterceptor(e){}onKeyDown(e){const t=()=>{e.preventDefault(),e.stopPropagation()};if(46!==e.keyCode||this.context.editing_mode)if("Insert"!==e.key||this.props.inDetail||e.shiftKey||"insert"!==this.props.actorData.insert_action||e.ctrlKey||e.altKey||this.data.editing_mode){if(this.props.actorData.hasOwnProperty("hotkeys")&&(e.ctrlKey||e.shiftKey||e.altKey)){if(!this.context.sr.length)return;this.props.actorData.hotkeys.forEach((i=>{e.ctrlKey===i.ctrl&&e.shiftKey===i.shift&&e.altKey===i.alt&&e.keyCode===i.keycode&&(t(),this.context.controller.actionHandler.runAction({an:i.ba,actorId:this.props.actorData.id}))}))}}else t(),this.context.controller.actionHandler.runAction({an:"insert",actorId:this.props.actorData.id});else t(),this.context.sr.length&&this.context.controller.actionHandler.runAction({an:"delete_selected",actorId:this.props.actorData.id})}quickFilter(e){this.context.controller.history.replace({[n.URL_PARAM_FILTER]:e.query})}get_current_grid_config(e){let t=[],i=[],s=[];if(this.GridElement){let e=Array.from(this.GridElement.dataTable.getTable().querySelectorAll(".col-header-label")),o=e.map((e=>parseInt(e.getAttribute("value")))).map((e=>this.context.static.actorData.col.find((t=>t.fields_index===e)))),r=e.map((e=>e.closest("th")));o.forEach(((e,o)=>{t.push(e.name),i.push(Math.floor(r[o].getBoundingClientRect().width)),s.push(!1)}))}return e[n.URL_PARAM_COLUMNS]=t,e[n.URL_PARAM_HIDDENS]=s,e[n.URL_PARAM_WIDTHS]=i,e}render(){if(!this.state.ready)return null;if(!this.data.urlParams||this.props.actorData.hide_if_empty&&this.props.inDetail&&0===this.data.rows.length)return null;let e=(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.context.title||this.props.actorData.label||" "}}),this.props.inDetail?(0,l.jsx)("span",{style:{float:"right"},children:(0,l.jsx)(D,{parent:this})}):this.context.controller.static.isMobile?(0,l.jsx)("div",{style:{position:"fixed",right:"0px",top:"50%",transform:"translate(0, -50%)",maxWidth:"40px",background:"#2255AA40",borderRadius:"3px",zIndex:999999},children:(0,l.jsx)(v,{query:this.context.query,parent:this,side:!0})}):(0,l.jsx)(this.ex.prButton.Button,{icon:this.context.toolbarState==n.TOOLBAR_STATE_HIDDEN?"pi pi-caret-up":this.context.toolbarState==n.TOOLBAR_STATE_VISIBLE?"pi pi-caret-down":"pi pi-ellipsis-h",label:"",onClick:e=>{this.context.controller.history.replace({toolbarState:this.ex.u.getNextToolbarState(this.context.toolbarState)})},style:{float:"right",background:"#6c8999"}})]});e=this.props.inDetail?(0,l.jsx)("div",{className:"p-panel p-component",children:(0,l.jsx)("div",{className:"l-detail-header p-panel-header",children:e})}):(0,l.jsx)("div",{className:"l-detail-header",children:e});let t=(0,l.jsx)(y,{parent:this,ref:e=>this.paginator=e,slider:!0,rowsPerPage:this.context[n.URL_PARAM_LIMIT]}),i=this.state.displayMode,o=i&&this.props.actorData.params_panel_pos;return(0,l.jsxs)(s.Fragment,{children:[e,(0,l.jsxs)(this.ex.sc.DataContext.Context.Provider,{value:this.state.context,children:[!this.props.inDetail&&(0,l.jsxs)("div",{className:"l-header",children:["top"===o&&(0,l.jsx)(A,{}),(0,l.jsx)(v,{query:this.context.query,parent:this}),"bottom"===o&&(0,l.jsx)(A,{})]}),(0,l.jsxs)("div",{className:this.ex.classNames.default("",{["l-params-panel-"+o]:["left","right"].includes(o)}),children:[["left","right"].includes(o)&&(0,l.jsx)(A,{}),(0,l.jsx)("div",{className:"l-grid",children:i===n.DISPLAY_MODE_DETAIL?(0,l.jsx)(d,{editing_mode:this.context.editing_mode,parent:this,ref:e=>this.LinoDetail=e,urlParams:this.context,window_layout:this.context.window_layout}):(0,l.jsxs)(s.Fragment,{children:[this.context.controller.APP.state.site_data.top_paginator&&t,[n.DISPLAY_MODE_STORY,n.DISPLAY_MODE_LIST].includes(i)?(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:this.state.context.html_text}}):n.DISPLAY_MODE_TABLE===i?(0,l.jsx)(m,{loading:this.state.loading,parent:this,ref:e=>this.GridElement=e,urlParams:this.context}):n.DISPLAY_MODE_CARDS===i?(0,l.jsx)(g,{urlParams:this.context}):n.DISPLAY_MODE_GALLERY===i&&(0,l.jsx)(_,{urlParams:this.context}),!this.context.controller.APP.state.site_data.top_paginator&&t]})})]})]})]})}}S.requiredModules=["_","AbortController","classNames","prButton","u","sc"],S.iPool=f,S.contextType=a.URLContextType,S.propTypes={actorData:r().object.isRequired,inDetail:r().bool},S.defaultProps={inDetail:!1}}}]);
//# sourceMappingURL=main.LinoBody_SiteContext.66017578e5ada83e6b86.js.map