"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7022],{17022:function(e,n,i){var r=i(75582),s=i(82394),t=i(21764),l=i(82684),o=i(69864),c=i(34376),d=i(71180),u=i(70652),a=i(15338),m=i(97618),j=i(55485),f=i(85854),p=i(65956),x=i(28274),v=i(38276),h=i(75499),Z=i(30160),g=i(17488),b=i(35686),P=i(8193),y=i(72473),I=i(70515),k=i(24755),O=i(3917),C=i(76417),M=i(36717),S=i(86735),w=i(42122),_=i(72619),N=i(95924),R=i(28598);function T(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,r)}return i}function E(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?T(Object(i),!0).forEach((function(n){(0,s.Z)(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}var A,H=2*I.iI;!function(e){e.PERMISSIONS="Permissions",e.USERS="Users"}(A||(A={})),n.Z=function(e){var n,i=e.contained,s=e.onCancel,T=e.slug,D=(0,c.useRouter)(),F=(0,l.useState)(!0),B=F[0],U=F[1],G=(0,l.useState)(null),L=G[0],q=G[1],z=(0,l.useState)({}),K=z[0],W=z[1],Y=(0,l.useState)(null),$=Y[0],V=Y[1],J=(0,l.useCallback)((function(e,n,i){V(E(E({},e),{},{permissionsMapping:(0,S.HK)(n||[],(function(e){return e.id})),usersMapping:(0,S.HK)(i||[],(function(e){return e.id}))}))}),[V]),Q=(0,l.useCallback)((function(e){W((function(n){return E(E({},n),e)})),V((function(n){return E(E({},n),e)}))}),[W,V]),X=b.ZP.roles.detail(T,{},{revalidateOnFocus:!1}).data,ee=(0,l.useMemo)((function(){return null===X||void 0===X?void 0:X.role}),[X]);(0,l.useEffect)((function(){ee&&J(ee,null===ee||void 0===ee?void 0:ee.role_permissions,null===ee||void 0===ee?void 0:ee.users)}),[J,ee]);var ne=(0,o.Db)(ee?b.ZP.roles.useUpdate(null===ee||void 0===ee?void 0:ee.id):b.ZP.roles.useCreate(),{onSuccess:function(e){return(0,_.wD)(e,{callback:function(e){var n=e.role;W({}),J(n,null===n||void 0===n?void 0:n.role_permissions,null===n||void 0===n?void 0:n.users),ee||D.push("/settings/workspace/roles/".concat(null===n||void 0===n?void 0:n.id)),t.Am.success(ee?"Role successfully updated.":"New role created successfully.",{position:t.Am.POSITION.BOTTOM_RIGHT,toastId:"role-mutate-success-".concat(n.id)})},onErrorCallback:function(e){var n=e.error,i=n.errors,r=n.exception,s=n.message,l=n.type;t.Am.error((null===i||void 0===i?void 0:i.error)||r||s,{position:t.Am.POSITION.BOTTOM_RIGHT,toastId:l})}})}}),ie=(0,r.Z)(ne,2),re=ie[0],se=ie[1].isLoading,te=(0,o.Db)(b.ZP.roles.useDelete(null===ee||void 0===ee?void 0:ee.id),{onSuccess:function(e){return(0,_.wD)(e,{callback:function(){D.push("/settings/workspace/roles"),t.Am.success("Role successfully delete.",{position:t.Am.POSITION.BOTTOM_RIGHT,toastId:"role-delete-success-".concat(null===ee||void 0===ee?void 0:ee.id)})},onErrorCallback:function(e){var n=e.error,i=n.errors,r=n.exception,s=n.message,l=n.type;t.Am.error((null===i||void 0===i?void 0:i.error)||r||s,{position:t.Am.POSITION.BOTTOM_RIGHT,toastId:l})}})}}),le=(0,r.Z)(te,2),oe=le[0],ce=le[1].isLoading,de=b.ZP.permissions.list({_limit:1e3},{},{pauseFetch:!ee}).data,ue=(0,l.useMemo)((function(){return(0,S.YC)((null===de||void 0===de?void 0:de.permissions)||[],"entity_name")}),[de]),ae=(0,l.useMemo)((function(){return(null===$||void 0===$?void 0:$.permissionsMapping)||{}}),[$]),me=(0,l.useMemo)((function(){return(0,S.YC)(Object.values(ae),"entity_name")}),[ae]),je=b.ZP.users.list({},{},{pauseFetch:!ee}).data,fe=(0,l.useMemo)((function(){return(0,S.YC)((null===je||void 0===je?void 0:je.users)||[],(function(e){return(0,C.s)(e)}))}),[je]),pe=(0,l.useMemo)((function(){return(null===$||void 0===$?void 0:$.usersMapping)||{}}),[$]),xe=(0,l.useMemo)((function(){return(0,S.YC)(Object.values(pe),(function(e){return(0,C.s)(e)}))}),[pe]),ve=(0,l.useMemo)((function(){return(null===me||void 0===me?void 0:me.length)>=1}),[me]),he=(0,l.useMemo)((function(){return(0,R.jsx)(d.ZP,{beforeIcon:(0,R.jsx)(y.mm,{}),compact:!0,onClick:function(){q(A.PERMISSIONS),U(!1)},primary:!ve,secondary:ve,small:!0,children:"Add permission"})}),[ve,q,U]),Ze=(0,l.useMemo)((function(){return(null===xe||void 0===xe?void 0:xe.length)>=1}),[xe]),ge=(0,l.useMemo)((function(){return(0,R.jsx)(d.ZP,{beforeIcon:(0,R.jsx)(y.mm,{}),compact:!0,onClick:function(){q(A.USERS),U(!1)},primary:!Ze,secondary:Ze,small:!0,children:"Add user"})}),[Ze]),be=(0,l.useCallback)((function(e,n){return(0,R.jsx)(h.Z,{columnFlex:[null,null,2,1,1,6],columns:[{label:function(){var n=null===e||void 0===e?void 0:e.every((function(e){var n=e.id;return null===ae||void 0===ae?void 0:ae[n]}));return(0,R.jsx)(u.Z,{checked:n,onClick:function(i){(0,N.j)(i),Q(n?{permissionsMapping:{}}:{permissionsMapping:(0,S.HK)(e,(function(e){return e.id}))})}},"checkbox")},uuid:"actions"},{uuid:"ID"},{uuid:"Entity"},{uuid:"Subtype"},{uuid:"Entity ID"},{rightAligned:!0,uuid:"Access"}],onClickRow:n?function(n){var i=e[n];i&&window.open("/settings/workspace/permissions/".concat(null===i||void 0===i?void 0:i.id),"_blank").focus()}:null,rows:null===e||void 0===e?void 0:e.map((function(e){var n=e.access,i=e.entity,r=e.entity_id,s=e.entity_name,t=e.entity_type,l=e.id,o=n?(0,M.q)(n):[],c=(null===o||void 0===o?void 0:o.length)||0,d=!(null===ae||void 0===ae||!ae[l]);return[(0,R.jsx)(u.Z,{checked:d,onClick:function(n){(0,N.j)(n);var i=E({},ae);d?null===i||void 0===i||delete i[l]:i[l]=e,Q({permissionsMapping:i})}},"checkbox"),(0,R.jsx)(Z.ZP,{default:!0,monospace:!0,children:l},"id"),(0,R.jsx)(Z.ZP,{monospace:!0,children:s||i},"entityName"),(0,R.jsx)(Z.ZP,{default:!0,monospace:!!t,children:t||"-"},"entityType"),(0,R.jsx)(Z.ZP,{default:!0,monospace:!!r,children:r||"-"},"entityID"),(0,R.jsx)("div",{children:c>=1&&(0,R.jsx)(j.ZP,{alignItems:"center",flexWrap:"wrap",justifyContent:"flex-end",children:null===o||void 0===o?void 0:o.map((function(e,n){return(0,R.jsx)("div",{children:(0,R.jsxs)(Z.ZP,{default:!0,monospace:!0,small:!0,children:[e,c>=2&&n<c-1&&(0,R.jsx)(Z.ZP,{inline:!0,muted:!0,small:!0,children:",\xa0"})]})},e)}))})},"access")]})),uuid:"permissions"})}),[ae,Q]),Pe=(0,l.useCallback)((function(e,n){return(0,R.jsx)(h.Z,{columnFlex:[null,1,1,1],columns:[{label:function(){var n=null===e||void 0===e?void 0:e.every((function(e){var n=e.id;return null===pe||void 0===pe?void 0:pe[n]}));return(0,R.jsx)(u.Z,{checked:n,onClick:function(i){(0,N.j)(i),Q(n?{usersMapping:{}}:{usersMapping:(0,S.HK)(e,(function(e){return e.id}))})}},"checkbox")},uuid:"actions"},{uuid:"Username"},{uuid:"First name"},{uuid:"Last name"}],onClickRow:n?function(n){var i=e[n];i&&window.open("/settings/workspace/users/".concat(null===i||void 0===i?void 0:i.id),"_blank").focus()}:null,rows:null===e||void 0===e?void 0:e.map((function(e){var n=e.first_name,i=e.id,r=e.last_name,s=e.username,t=!(null===pe||void 0===pe||!pe[i]);return[(0,R.jsx)(u.Z,{checked:t,onClick:function(n){(0,N.j)(n);var r=E({},pe);t?null===r||void 0===r||delete r[i]:r[i]=e,Q({usersMapping:r})}},"checkbox"),(0,R.jsx)(Z.ZP,{children:s},"username"),(0,R.jsx)(Z.ZP,{default:!0,children:n},"firstName"),(0,R.jsx)(Z.ZP,{default:!0,children:r},"lastName")]})),uuid:"users"})}),[pe,Q]),ye=(0,l.useMemo)((function(){return be(ue)}),[be,ue]),Ie=(0,l.useMemo)((function(){return Pe(fe)}),[Pe,fe]),ke=(0,l.useMemo)((function(){return be(me,!0)}),[be,me]),Oe=(0,l.useMemo)((function(){return Pe(xe,!0)}),[Pe,xe]),Ce=(0,R.jsxs)(P.N,{children:[(0,R.jsxs)(p.Z,{noPadding:!0,children:[(0,R.jsx)(v.Z,{p:I.cd,children:(0,R.jsx)(f.Z,{level:4,children:"Role"})}),(0,R.jsx)(a.Z,{light:!0}),(0,R.jsx)(v.Z,{p:I.cd,children:(0,R.jsxs)(j.ZP,{alignItems:"center",children:[(0,R.jsxs)(Z.ZP,{danger:"name"in K&&!(null!==$&&void 0!==$&&$.name),default:!0,large:!0,children:["Name ","name"in K&&!(null!==$&&void 0!==$&&$.name)&&(0,R.jsx)(Z.ZP,{danger:!0,inline:!0,large:!0,children:"is required"})]}),(0,R.jsx)(v.Z,{mr:I.cd}),(0,R.jsx)(m.Z,{flex:1,children:(0,R.jsx)(g.Z,{afterIcon:(0,R.jsx)(y.I8,{}),afterIconClick:function(e,n){var i;null===n||void 0===n||null===(i=n.current)||void 0===i||i.focus()},afterIconSize:H,alignRight:!0,autoComplete:"off",large:!0,noBackground:!0,noBorder:!0,fullWidth:!0,onChange:function(e){return Q({name:e.target.value})},paddingHorizontal:0,paddingVertical:0,placeholder:"e.g. Archmage",value:(null===$||void 0===$?void 0:$.name)||""})})]})})]}),(0,R.jsx)(v.Z,{mb:I.HN}),ee&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(p.Z,{noPadding:!0,children:[(0,R.jsx)(v.Z,{p:I.cd,children:(0,R.jsxs)(j.ZP,{alignItems:"center",justifyContent:"space-between",children:[(0,R.jsx)(f.Z,{level:4,children:"Permissions"}),(0,R.jsx)(v.Z,{mr:I.cd}),ve&&(0,R.jsx)(j.ZP,{alignItems:"center",children:he})]})}),(0,R.jsx)(a.Z,{light:!0}),!ve&&(0,R.jsxs)(v.Z,{p:I.cd,children:[(0,R.jsx)(v.Z,{mb:I.cd,children:(0,R.jsx)(Z.ZP,{default:!0,children:"This role currently has no permissions attached."})}),(0,R.jsx)(j.ZP,{alignItems:"center",children:he})]}),ve&&(0,R.jsx)(v.Z,{pb:I.Mq,children:ke})]}),(0,R.jsx)(v.Z,{mb:I.HN}),(0,R.jsxs)(p.Z,{noPadding:!0,children:[(0,R.jsx)(v.Z,{p:I.cd,children:(0,R.jsxs)(j.ZP,{alignItems:"center",justifyContent:"space-between",children:[(0,R.jsx)(f.Z,{level:4,children:"Users"}),(0,R.jsx)(v.Z,{mr:I.cd}),Ze&&(0,R.jsx)(j.ZP,{alignItems:"center",children:ge})]})}),(0,R.jsx)(a.Z,{light:!0}),!Ze&&(0,R.jsxs)(v.Z,{p:I.cd,children:[(0,R.jsx)(v.Z,{mb:I.cd,children:(0,R.jsx)(Z.ZP,{default:!0,children:"There are currently no users with this role."})}),(0,R.jsx)(j.ZP,{alignItems:"center",children:ge})]}),Ze&&(0,R.jsx)(v.Z,{pb:I.Mq,children:Oe})]}),(0,R.jsx)(v.Z,{mb:I.HN}),(0,R.jsxs)(p.Z,{noPadding:!0,children:[(0,R.jsx)(v.Z,{p:I.cd,children:(0,R.jsx)(f.Z,{level:4,children:"Metadata"})}),(0,R.jsx)(a.Z,{light:!0}),(0,R.jsx)(v.Z,{p:I.cd,children:(0,R.jsxs)(j.ZP,{alignItems:"center",children:[(0,R.jsx)(Z.ZP,{default:!0,large:!0,children:"Last updated"}),(0,R.jsx)(v.Z,{mr:I.cd}),(0,R.jsxs)(m.Z,{alignItems:"center",flex:1,justifyContent:"flex-end",children:[(0,R.jsx)(Z.ZP,{large:!0,monospace:!0,muted:!0,children:(null===$||void 0===$?void 0:$.updated_at)&&(0,O.d$)(null===$||void 0===$?void 0:$.updated_at,{includeSeconds:!0})}),(0,R.jsx)(v.Z,{mr:I.cd}),(0,R.jsx)(y.Pf,{muted:!0,size:H}),(0,R.jsx)(v.Z,{mr:1})]})]})}),(0,R.jsx)(a.Z,{light:!0}),(0,R.jsx)(v.Z,{p:I.cd,children:(0,R.jsxs)(j.ZP,{alignItems:"center",children:[(0,R.jsx)(Z.ZP,{default:!0,large:!0,children:"Created at"}),(0,R.jsx)(v.Z,{mr:I.cd}),(0,R.jsxs)(m.Z,{alignItems:"center",flex:1,justifyContent:"flex-end",children:[(0,R.jsx)(Z.ZP,{large:!0,monospace:!0,muted:!0,children:(null===$||void 0===$?void 0:$.created_at)&&(0,O.d$)(null===$||void 0===$?void 0:$.created_at,{includeSeconds:!0})}),(0,R.jsx)(v.Z,{mr:I.cd}),(0,R.jsx)(y.Pf,{muted:!0,size:H}),(0,R.jsx)(v.Z,{mr:1})]})]})}),(0,R.jsx)(a.Z,{light:!0}),(0,R.jsx)(v.Z,{p:I.cd,children:(0,R.jsxs)(j.ZP,{alignItems:"center",children:[(0,R.jsx)(Z.ZP,{default:!0,large:!0,children:"Created by"}),(0,R.jsx)(v.Z,{mr:I.cd}),(0,R.jsxs)(m.Z,{alignItems:"center",flex:1,justifyContent:"flex-end",children:[(0,R.jsx)(Z.ZP,{large:!0,monospace:!0,muted:!0,children:(0,C.s)(null===ee||void 0===ee?void 0:ee.user)}),(0,R.jsx)(v.Z,{mr:I.cd}),(0,R.jsx)(y.SC,{muted:!0,size:H}),(0,R.jsx)(v.Z,{mr:1})]})]})})]}),(0,R.jsx)(v.Z,{mb:I.HN})]}),(0,R.jsxs)(j.ZP,{children:[(0,R.jsx)(d.ZP,{beforeIcon:(0,R.jsx)(y.vc,{}),disabled:!K||!(null!==(n=Object.keys(K))&&void 0!==n&&n.length),loading:se,onClick:function(){return re({role:E(E({},(0,w.GL)($,["name"],{include_blanks:!0})),{},{permission_ids:Object.keys((null===$||void 0===$?void 0:$.permissionsMapping)||{}).map((function(e){return Number(e)})),user_ids:Object.keys((null===$||void 0===$?void 0:$.usersMapping)||{}).map((function(e){return Number(e)}))})})},primary:!0,children:ee?"Save changes":"Create new role"}),s&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(v.Z,{mr:I.cd}),(0,R.jsx)(d.ZP,{onClick:function(){return null===s||void 0===s?void 0:s()},secondary:!0,children:"Cancel and go back"})]}),ee&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(v.Z,{mr:I.cd}),(0,R.jsx)(d.ZP,{beforeIcon:(0,R.jsx)(y.rF,{}),danger:!0,loading:ce,onClick:function(){return oe()},children:"Delete role"})]})]})]});return i?Ce:(0,R.jsx)(x.Z,{after:A.PERMISSIONS===L?ye:A.USERS===L?Ie:null,afterHeader:(0,R.jsx)(v.Z,{px:I.cd,children:(0,R.jsx)(Z.ZP,{bold:!0,children:L})}),afterHidden:B,afterWidth:60*I.iI,appendBreadcrumbs:!0,breadcrumbs:[{label:function(){return"Roles"},linkProps:{href:"/settings/workspace/roles"}},{bold:!0,label:function(){return null===ee||void 0===ee?void 0:ee.name}}],hideAfterCompletely:!0,setAfterHidden:U,title:null!==ee&&void 0!==ee&&ee.name?"".concat(null===ee||void 0===ee?void 0:ee.name," role"):"New role",uuidItemSelected:k.B2.ROLES,uuidWorkspaceSelected:k.Pl.USER_MANAGEMENT,children:ee&&Ce})}},36717:function(e,n,i){i.d(n,{q:function(){return t}});var r=i(75582),s=i(36288);function t(e){return Object.entries(s.K4).reduce((function(n,i){var s=(0,r.Z)(i,2),t=s[0],l=s[1];return e&Number(t)?n.concat(l):n}),[])}}}]);