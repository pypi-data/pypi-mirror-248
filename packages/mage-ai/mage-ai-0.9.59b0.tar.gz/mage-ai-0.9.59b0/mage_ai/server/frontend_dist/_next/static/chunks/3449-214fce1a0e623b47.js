"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3449],{1589:function(e,n,t){var o=t(82684);var i="function"===typeof Object.is?Object.is:function(e,n){return e===n&&(0!==e||1/e===1/n)||e!==e&&n!==n},u=o.useState,l=o.useEffect,r=o.useLayoutEffect,c=o.useDebugValue;function a(e){var n=e.getSnapshot;e=e.value;try{var t=n();return!i(e,t)}catch(o){return!0}}var s="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,n){return n()}:function(e,n){var t=n(),o=u({inst:{value:t,getSnapshot:n}}),i=o[0].inst,s=o[1];return r((function(){i.value=t,i.getSnapshot=n,a(i)&&s({inst:i})}),[e,t,n]),l((function(){return a(i)&&s({inst:i}),e((function(){a(i)&&s({inst:i})}))}),[e]),c(t),t};n.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:s},73847:function(e,n,t){var o=t(82684),i=t(48216);var u="function"===typeof Object.is?Object.is:function(e,n){return e===n&&(0!==e||1/e===1/n)||e!==e&&n!==n},l=i.useSyncExternalStore,r=o.useRef,c=o.useEffect,a=o.useMemo,s=o.useDebugValue;n.useSyncExternalStoreWithSelector=function(e,n,t,o,i){var d=r(null);if(null===d.current){var f={hasValue:!1,value:null};d.current=f}else f=d.current;d=a((function(){function e(e){if(!c){if(c=!0,l=e,e=o(e),void 0!==i&&f.hasValue){var n=f.value;if(i(n,e))return r=n}return r=e}if(n=r,u(l,e))return n;var t=o(e);return void 0!==i&&i(n,t)?n:(l=e,r=t)}var l,r,c=!1,a=void 0===t?null:t;return[function(){return e(n())},null===a?void 0:function(){return e(a())}]}),[n,t,o,i]);var v=l(e,d[0],d[1]);return c((function(){f.hasValue=!0,f.value=v}),[v]),s(v),v}},48216:function(e,n,t){e.exports=t(1589)},81550:function(e,n,t){e.exports=t(73847)},43449:function(e,n,t){var o=t(82394),i=t(75582),u=t(17717),l=t(82684),r=t(49555),c=t(69864),a=t(40761),s=t(44425),d=t(71180),f=t(92677),v=t(75810),p=t(89706),h=t(55485),b=t(93369),S=t(57653),g=t(38276),y=t(35686),k=t(39643),m=t(11498),E=t(85385),j=t(80330),O=t(86735),w=t(81728),P=t(72619),Z=t(42041),x=t(44688),C=t(28598);function D(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function T(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?D(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}n.Z=function(e){var n,t=e.active,D=e.addNewBlock,_=e.disableRefreshWarning,R=e.fetchPipeline,I=e.fetchVariables,N=e.filePath,V=e.hideHeaderButtons,M=e.onContentChange,U=e.onUpdateFileSuccess,A=e.openSidekickView,F=e.pipeline,G=e.saveFile,L=e.selectedFilePath,X=e.sendTerminalMessage,B=e.setDisableShortcuts,H=e.setErrors,q=e.setFilesTouched,J=e.setSelectedBlock,W=(0,r.j)("apiReloads"),z=(0,i.Z)(W,2)[1],K=(0,l.useState)(null),Q=K[0],Y=K[1],$=(0,l.useState)(!1),ee=$[0],ne=($[1],(0,l.useRef)(null)),te=(0,l.useMemo)((function(){return new a.Z}),[]),oe=(0,l.useMemo)((function(){return{api_key:m.lG,token:te.decodedToken.token}}),[te]),ie=y.ZP.statuses.list().data,ue=(0,l.useMemo)((function(){var e,n;return null===ie||void 0===ie||null===(e=ie.statuses)||void 0===e||null===(n=e[0])||void 0===n?void 0:n.repo_path}),[ie]),le=y.ZP.file_contents.detail(N).data;(0,l.useEffect)((function(){null!==le&&void 0!==le&&le.file_content?Y(le.file_content):null!==le&&void 0!==le&&le.error&&(0,P.h$)(le,{onErrorCallback:function(e,n){return H({errors:n,response:e})}})}),[le,H]);var re=(0,l.useState)(null===Q||void 0===Q?void 0:Q.content),ce=re[0],ae=re[1],se=(0,l.useCallback)((function(e){ae(e),M&&(null===M||void 0===M||M(e))}),[M]),de=(0,l.useState)(!1),fe=de[0],ve=de[1];(0,l.useEffect)((function(){t&&B&&(null===B||void 0===B||B(!0))}),[t,B]),(0,l.useEffect)((function(){var e;L&&(null===ne||void 0===ne||null===(e=ne.current)||void 0===e||e.scrollIntoView())}),[L]);var pe=(0,c.Db)(y.ZP.file_contents.useUpdate((null===Q||void 0===Q?void 0:Q.path)&&encodeURIComponent(null===Q||void 0===Q?void 0:Q.path)),{onSuccess:function(e){return(0,P.wD)(e,{callback:function(e){var n=e.file_content;z((function(e){return T(T({},e),{},(0,o.Z)({},"FileVersions/".concat(null===Q||void 0===Q?void 0:Q.path),Number(new Date)))})),U&&(null===U||void 0===U||U(n))},onErrorCallback:function(e,n){return null===H||void 0===H?void 0:H({errors:n,response:e})}})}}),he=(0,i.Z)(pe,1)[0],be=(0,l.useCallback)((function(e,n){if(G)return G(e,n);he({file_content:T(T({},n),{},{content:e})}).then((function(){decodeURIComponent(N).split(u.sep).pop()===p.dT.METADATA_YAML&&I&&(null===I||void 0===I||I())})),null===q||void 0===q||q((function(e){return T(T({},e),{},(0,o.Z)({},null===n||void 0===n?void 0:n.path,!1))})),ve(!1)}),[I,N,G,q,he]),Se=(0,l.useMemo)((function(){return(0,j.lU)()}),[]),ge=(0,l.useMemo)((function(){var e,n,t,o;return null===(null===Q||void 0===Q||null===(e=Q.path)||void 0===e?void 0:e.match(Se))?p.Lu.TXT:null===Q||void 0===Q||null===(n=Q.path)||void 0===n||null===(t=n.match(Se))||void 0===t||null===(o=t[0])||void 0===o?void 0:o.split(".")[1]}),[Se,Q]),ye=(0,l.useMemo)((function(){if(null!==Q&&void 0!==Q&&Q.path)return(0,C.jsx)(v.Z,{autoHeight:!0,language:p.nB[ge],onChange:function(e){se(e),q&&q((function(e){return null!==e&&void 0!==e&&e[null===Q||void 0===Q?void 0:Q.path]?e:T(T({},e),{},(0,o.Z)({},null===Q||void 0===Q?void 0:Q.path,!0))})),ve(!0)},onSave:function(e){be(e,Q)},padding:10,selected:!0,textareaFocused:!0,value:(0,w.Pb)(null===Q||void 0===Q?void 0:Q.content)?JSON.stringify(JSON.parse(null===Q||void 0===Q?void 0:Q.content),null,2):null===Q||void 0===Q?void 0:Q.content,width:"100%"})}),[Q,ge,be,se,q]),ke=null!==F&&void 0!==F&&F.blocks?(0,O.sE)(null===F||void 0===F?void 0:F.blocks,(function(e){var n=e.type;return s.tf.DATA_EXPORTER===n})):null,me=(0,c.Db)(y.ZP.blocks.pipelines.useUpdate(encodeURIComponent(null===F||void 0===F?void 0:F.uuid),encodeURIComponent(null===ke||void 0===ke?void 0:ke.uuid)),{onSuccess:function(e){return(0,P.wD)(e,{callback:function(){null===R||void 0===R||R()}})}}),Ee=(0,i.Z)(me,1)[0],je=D&&F&&Q&&p.tE.includes(ge)&&(0,j.ck)(null===Q||void 0===Q||null===(n=Q.path)||void 0===n?void 0:n.split(u.sep))&&(0,C.jsx)(d.ZP,{onClick:function(){var e=(null===F||void 0===F?void 0:F.type)===S.qL.INTEGRATION,n=(0,j.TU)(Q,ue,F);D(n,(function(n){e&&ke&&Ee({block:T(T({},ke),{},{upstream_blocks:[n.uuid]})}),null===J||void 0===J||J(n)}))},primary:!0,children:"Add to current pipeline"}),Oe=X&&(0,C.jsx)(g.Z,{m:2,children:(0,C.jsx)(b.ZP,{disabled:!ue,inline:!0,loading:ee,onClick:function(){null===A||void 0===A||A(E.cH.TERMINAL),null===X||void 0===X||X(JSON.stringify(T(T({},oe),{},{command:["stdin","pip install -r ".concat(ue,"/requirements.txt\r")]})))},title:ue?"Pip install packages from your saved requirements.txt file (\u2318+S to save).":"Please use right panel terminal to install packages.",uuid:"FileEditor/InstallPackages",children:"Install packages"})}),we="FileEditor/".concat(null===Q||void 0===Q?void 0:Q.path),Pe=(0,x.y)(),Ze=Pe.registerOnKeyDown,xe=Pe.unregisterOnKeyDown;return(0,l.useEffect)((function(){return function(){xe(we)}}),[xe,we]),Ze(we,(function(e,n){if(t&&!_)if((0,Z.y)([k.zX,k.Um],n)||(0,Z.y)([k.PQ,k.Um],n))e.preventDefault(),be(ce,Q);else if(fe&&(0,Z.y)([k.zX,k.hS],n)){e.preventDefault();var o="".concat(Q.path," has changes that are unsaved. ")+"Click cancel and save your changes before reloading page.";"undefined"!==typeof location&&window.confirm(o)&&location.reload()}}),[t,ce,_,Q,be,fe]),(0,C.jsxs)("div",{ref:ne,children:[!V&&(0,C.jsx)(g.Z,{p:2,children:(0,C.jsxs)(h.ZP,{justifyContent:"space-between",children:[(0,C.jsxs)(f.Z,{children:[je,(0,C.jsx)(d.ZP,{disabled:!ce,onClick:function(e){e.preventDefault(),be(ce,Q)},title:ce?null:"No changes have been made to this file.",children:"Save file content"})]}),A&&(0,C.jsx)(f.Z,{children:(0,C.jsx)(d.ZP,{compact:!0,onClick:function(){A(E.cH.FILE_VERSIONS)},small:!0,title:"View previous changes to this file.",children:"Show versions"})})]})}),ye,N===p.dT.REQS_TXT&&Oe]})}},49555:function(e,n,t){t.d(n,{j:function(){return s}});var o=t(82684);const i=e=>{let n;const t=new Set,o=(e,o)=>{const i="function"===typeof e?e(n):e;if(i!==n){const e=n;n=o?i:Object.assign({},n,i),t.forEach((t=>t(n,e)))}},i=()=>n,u={setState:o,getState:i,subscribe:e=>(t.add(e),()=>t.delete(e)),destroy:()=>t.clear()};return n=e(o,i,u),u};var u=t(81550);const{useSyncExternalStoreWithSelector:l}=u;const r=e=>{const n="function"===typeof e?(e=>e?i(e):i)(e):e,t=(e,t)=>function(e,n=e.getState,t){const i=l(e.subscribe,e.getState,e.getServerState||e.getState,n,t);return(0,o.useDebugValue)(i),i}(n,e,t);return Object.assign(t,n),t};var c=e=>e?r(e):r;var a=(e=>{const n=c((()=>e)),t=(Object.keys(e),(e,t)=>{n.setState((n=>{return{[e]:(o=n[e],i=t,"function"==typeof i?i(o):i)};var o,i}))});return{useGlobalState:e=>{const i=(0,o.useCallback)((n=>n[e]),[e]);return[n(i),(0,o.useCallback)((n=>t(e,n)),[e])]},getGlobalState:e=>n.getState()[e],setGlobalState:t,subscribe:(e,t)=>{n.subscribe(((n,o)=>{n[e]!==o[e]&&t(n[e])}))}}})({apiReloads:{}}),s=a.useGlobalState}}]);