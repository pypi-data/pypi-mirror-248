import{_ as e,o as t,f as i,a as s,n as l,F as o,i as n,C as a,t as d,v as r,j as h}from"./index-cPdmZZgQ.js";const g={props:{data:{type:Array,default:()=>[]},column:{type:Array,default:()=>[]},maxW:{type:String},highLight:{type:Boolean,default:!1}},data:()=>({dragLineLeft:0,activeDragIndex:-1,activeDragStartIndexOffsetLeft:0,gnipTableScrollWidth:"",showDragResizeLine:!1,columnDefault:0,dragedRecord:[],initTableWidth:0,dynamicTableWidth:0,fixedTableWidth:"fixed  z-[2] bg-default",highlightColumnIndex:-1}),computed:{computedResizeLineStyle(){return{left:this.dragLineLeft+"px"}}},mounted(){this.init(),window.addEventListener("resize",this.initTableScrollWidth)},methods:{init(){this.initTableScrollWidth(),this.dragedRecord=new Array(this.column.length).fill(0).map(((e,t)=>this.column[t].width?[!0,1*this.column[t].width]:[!1,0]))},initTableScrollWidth(){this.gnipTableScrollWidth=this.$refs.gnipTable.offsetWidth,this.dynamicTableWidth=this.gnipTableScrollWidth-1,this.initTableWidth=this.gnipTableScrollWidth+1;const e=this.column.filter((e=>!e.width)).length,t=this.column.filter((e=>e.width)).reduce(((e,t)=>e+1*t.width),0),i=(this.gnipTableScrollWidth-t)/e;this.columnDefault=i>0?i:0},handleMouseDown(e,t){this.computedDragLineOffsetStart(t.target),this.activeDragIndex=e,this.showDragResizeLine=!0,document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseup)},handleMouseMove(e){this.computedDragLineOffsetDraging(e),document.body.style.cursor="col-resize"},handleMouseup(e){this.computedDragLineOffsetDraging(e),this.setColGroupItemWidth(),this.activeDragStartIndexOffsetLeft=0,this.showDragResizeLine=!1,document.body.style.cursor="",document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mousedown",this.handleMouseDown),document.removeEventListener("mouseup",this.handleMouseup)},computedDragLineOffsetStart(e){let t=e.offsetParent,i=e.offsetLeft;for(;t&&t!=this.$refs.overflowWrap;)i+=t.offsetLeft,t=t.offsetParent;return this.dragLineLeft=i+this.$refs.overflowWrap.scrollLeft,!this.activeDragStartIndexOffsetLeft&&(this.activeDragStartIndexOffsetLeft=i),i},computedDragLineOffsetDraging(e){let t=e.clientX,i=this.$refs.overflowWrap,s=i.offsetLeft,l=i.offsetParent;for(;l;)s+=l.offsetLeft,l=l.offsetParent;let o=t-s<0?0:t-s;this.dragLineLeft=o+this.$refs.overflowWrap.scrollLeft},setColGroupItemWidth(){let e=this.dragLineLeft-this.activeDragStartIndexOffsetLeft;this.$nextTick((()=>{let{width:t}=this.$refs.colgroupItems[this.activeDragIndex].getBoundingClientRect();const i=e+t<70?70:e+t;this.dynamicTableWidth=this.dynamicTableWidth+e>this.initTableWidth?this.dynamicTableWidth+=e:this.initTableWidth-1,this.dragedRecord[this.activeDragIndex]=[!0,i];for(let e=0;e<this.$refs.colgroupItems.length;e++)e==this.activeDragIndex&&this.$refs.colgroupItems[this.activeDragIndex].setAttribute("width",i);this.activeDragIndex=-1}))},highlightColumn(e){this.highlightColumnIndex=e},resetHighlight(){this.highlightColumnIndex=-1}}},f={class:"gnip-table",ref:"gnipTable"},c={class:"w-full"},u=["onMouseover"],m=["onMousedown"],p={key:0},v=["onMouseover"],x={key:1},y=["colspan"],b={class:"data-empty"};const w=e(g,[["render",function(e,g,w,L,D,W){return t(),i("div",f,[s("div",{class:a(["overflow-wrap w-full",w.maxW]),ref:"overflowWrap",style:l({width:D.initTableWidth+"px"})},[s("div",{class:"table-wrap w-full",style:l({width:D.dynamicTableWidth+"px"})},[s("table",c,[s("colgroup",null,[(t(!0),i(o,null,n(w.column,((e,s)=>(t(),i("col",{key:s,ref_for:!0,ref:"colgroupItems"})))),128))]),s("thead",null,[s("tr",null,[(t(!0),i(o,null,n(w.column,((e,o)=>(t(),i("th",{key:o,class:a(["gnip-th",D.highlightColumnIndex===o?" bg-slate-200":"bg-[#f6f8fa]"]),onMouseover:e=>W.highlightColumn(w.highLight?o:-1),onMouseout:g[0]||(g[0]=(...e)=>W.resetHighlight&&W.resetHighlight(...e))},[s("span",{class:a(["block w-full whitespace-nowrap text-left",`${e.style||"px-2"} ${e.fixed?D.fixedTableWidth:""}`]),style:l({width:D.dragedRecord[o]?D.dragedRecord[o][0]?D.dragedRecord[o][1].toFixed(0)+"px":"":D.columnDefault+"px"})},d(e.title),7),s("span",{class:a(["drag-line hover:!bg-positive-dimmer hover:opacity-20",`${D.activeDragIndex===o?" !bg-primary-dimmest":""} ${D.highlightColumnIndex===o?"bg-positive-highest":""} ${o+1===w.column.length?"pointer-events-none":""}`]),style:l({background:o+1===w.column.length?"none":""}),onMousedown:e=>W.handleMouseDown(o,e)},null,46,m)],42,u)))),128))])]),w.data.length?(t(),i("tbody",p,[(t(!0),i(o,null,n(w.data,((s,h)=>(t(),i("tr",{key:s.id},[(t(!0),i(o,null,n(w.column,((o,n)=>(t(),i("td",{key:n,class:a(["whitespace-nowrap overflow-hidden",D.highlightColumnIndex===n?"hover:bg-primary-dimmest bg-[#ebf7ff]":""]),onMouseover:e=>W.highlightColumn(w.highLight?n:-1),onMouseout:g[1]||(g[1]=(...e)=>W.resetHighlight&&W.resetHighlight(...e))},[o.slot?(t(),i("div",{key:0,class:a(["text-left overflow-hidden",`${o.style||"px-2"}  ${o.fixed?D.fixedTableWidth:""}`]),style:l({width:D.dragedRecord[n]?D.dragedRecord[n][0]?D.dragedRecord[n][1].toFixed(0)+"px":"":D.columnDefault+"px"})},[r(e.$slots,o.slot,{row:s,index:h})],6)):(t(),i("div",{key:1,class:a(["text-left",`${o.style||"px-2"}  ${o.fixed?D.fixedTableWidth:""}`]),style:l({width:D.dragedRecord[n]?D.dragedRecord[n][0]?D.dragedRecord[n][1].toFixed(0)+"px":"":D.columnDefault+"px"})},d(s[o.key]||"-"),7))],42,v)))),128))])))),128))])):h("",!0),w.data.length?h("",!0):(t(),i("tfoot",x,[s("tr",null,[s("td",{colspan:w.column.length},[s("div",b,d(e.$t("common.table.empty")),1)],8,y)])]))]),D.showDragResizeLine?(t(),i("div",{key:0,class:"drag-resize-line",style:l(W.computedResizeLineStyle)},null,4)):h("",!0)],4)],6)],512)}]]);export{w as S};
