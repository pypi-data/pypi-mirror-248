#!/usr/bin/env python

# SPDX-FileCopyrightText: 2017-2022 Luis Falc√≥n <falcon@gnuhealth.org>
# SPDX-FileCopyrightText: 2017-2022 GNU Solidario <health@gnusolidario.org>

# SPDX-License-Identifier: GPL-3.0-or-later

#########################################################################
#             GNUHEALTH HOSPITAL MANAGEMENT - GTK CLIENT                #
#                     https://www.gnuhealth.org                         #
#########################################################################
#                   gnuhealth-client: launcher script                   #
#########################################################################
# This file is part of GNU Health.  The COPYRIGHT file at the top level of
# this repository contains the full copyright notices and license terms.

import sys
import os
try:
    DIR = os.path.abspath(os.path.normpath(os.path.join(__file__,
        '..', '..', 'gnuhealth')))
    if os.path.isdir(DIR):
        sys.path.insert(0, os.path.dirname(DIR))
except NameError:
    pass

if hasattr(sys, 'frozen'):
    if not ('-v' in sys.argv or '--verbose' in sys.argv or
            '-l' in sys.argv or '--log-level' in sys.argv):
        sys.stdout = open(os.devnull, 'w')
        sys.stderr = open(os.devnull, 'w')
    prefix = os.path.dirname(sys.executable)
    os.environ['GTK_EXE_PREFIX'] = prefix
    os.environ['GTK_DATA_PREFIX'] = prefix
    os.environ['XDG_DATA_DIRS'] = os.path.join(prefix, 'share')
    etc = os.path.join(prefix, 'etc')
    os.environ['GDK_PIXBUF_MODULE_FILE'] = os.path.join(
            etc, 'gtk-3.0', 'gdk-pixbuf.loaders')
    os.environ['GTK_IM_MODULE_FILE'] = os.path.join(
            etc, 'gtk-3.0', 'gtk.immodules')
    os.environ['GI_TYPELIB_PATH'] = os.path.join(
            prefix, 'lib', 'girepository-1.0')

    os.environ.setdefault('SSL_CERT_FILE',
        os.path.join(etc, 'ssl', 'cert.pem'))
    os.environ.setdefault('SSL_CERT_DIR',
        os.path.join(etc, 'ssl', 'certs'))

# Disable dbusmenu to show second menu in tabs
os.environ['UBUNTU_MENUPROXY'] = '0'
# overlay-scrollbar breaks treeview height
os.environ['LIBOVERLAY_SCROLLBAR'] = '0'

from gnuhealth.client import main
main()
